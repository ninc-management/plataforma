<nb-tabset fullWidth>
  <nb-tab
    [tabTitle]="utils.isPhone() ? '' : 'Dados'"
    tabIcon="info-outline"
    responsive
  >
    <form (ngSubmit)="updateContract()" #form="ngForm" aria-labelledby="title">
      <div class="row">
        <div class="col-md-7">
          <div class="form-control-group">
            <label class="label" for="input-author">Autor:</label>
            <input
              nbInput
              [(ngModel)]="contract.fullName"
              #author="ngModel"
              id="input-author"
              name="author"
              placeholder="Nome do autor"
              fullWidth
              fieldSize="large"
              [required]="validation.author.required"
              [status]="
                author.dirty ? (author.invalid ? 'danger' : 'success') : 'basic'
              "
              [attr.aria-invalid]="
                author.invalid && author.touched ? true : null
              "
              [readonly]="true"
            />
          </div>
        </div>
        <div class="col-3 col-md-2">
          <div class="form-control-group">
            <label class="label" for="input-version">Revisão:</label>
            <input
              nbInput
              [(ngModel)]="contract.version"
              #version="ngModel"
              id="input-version"
              name="version"
              placeholder="Revisão"
              fullWidth
              fieldSize="large"
              [required]="validation.version.required"
              [status]="
                version.dirty
                  ? version.invalid
                    ? 'danger'
                    : 'success'
                  : 'basic'
              "
              [attr.aria-invalid]="
                version.invalid && version.touched ? true : null
              "
              [readonly]="true"
            />
          </div>
        </div>
        <div class="col-9 col-md-3">
          <div class="form-control-group">
            <label class="label" for="input-status">Status:</label>
            <nb-select
              [(ngModel)]="contract.status"
              #status="ngModel"
              id="input-status"
              name="status"
              placeholder="Selecione o status"
              fullWidth
              size="large"
              [required]="validation.status.required"
              [status]="
                status.dirty ? (status.invalid ? 'danger' : 'success') : 'basic'
              "
              [attr.aria-invalid]="
                status.invalid && status.touched ? true : null
              "
            >
              <nb-option *ngFor="let status of STATOOS" [value]="status">
                {{ status }}
              </nb-option>
            </nb-select>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <div class="form-control-group">
            <label class="label" for="input-code">Código do orçamento:</label>
            <input
              nbInput
              [(ngModel)]="contract.code"
              #code="ngModel"
              id="input-code"
              name="code"
              placeholder="Código do Orçamento"
              fullWidth
              fieldSize="large"
              [required]="validation.code.required"
              [status]="
                code.dirty ? (code.invalid ? 'danger' : 'success') : 'basic'
              "
              [attr.aria-invalid]="code.invalid && code.touched ? true : null"
              [readonly]="true"
            />
          </div>
        </div>
        <div class="col-md-2">
          <div class="form-control-group">
            <label class="label" for="input-department">Diretoria:</label>
            <input
              nbInput
              [ngModel]="invoiceDepartment"
              #department="ngModel"
              id="input-department"
              name="department"
              placeholder="Código do Orçamento"
              fullWidth
              fieldSize="large"
              [required]="validation.department.required"
              [status]="
                department.dirty
                  ? department.invalid
                    ? 'danger'
                    : 'success'
                  : 'basic'
              "
              [attr.aria-invalid]="
                department.invalid && department.touched ? true : null
              "
              [readonly]="true"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="input-coordination">Coordenação:</label>
            <input
              nbInput
              [ngModel]="invoiceCoordination"
              #coordination="ngModel"
              id="input-coordination"
              name="coordination"
              placeholder="Código do Orçamento"
              fullWidth
              fieldSize="large"
              [required]="validation.coordination.required"
              [status]="
                coordination.dirty
                  ? coordination.invalid
                    ? 'danger'
                    : 'success'
                  : 'basic'
              "
              [attr.aria-invalid]="
                coordination.invalid && coordination.touched ? true : null
              "
              [readonly]="true"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="input-contractor">Cliente:</label>
            <input
              nbInput
              [(ngModel)]="contract.contractor"
              #contractor="ngModel"
              id="input-contractor"
              name="contractor"
              placeholder="Nome do cliente"
              fullWidth
              fieldSize="large"
              [nbTooltip]="tooltipText()"
              nbTooltipPlacement="top"
              nbTooltipStatus="primary"
              [required]="validation.contractor.required"
              [status]="
                contractor.dirty
                  ? contractor.invalid
                    ? 'danger'
                    : 'success'
                  : 'basic'
              "
              [attr.aria-invalid]="
                contractor.invalid && contractor.touched ? true : null
              "
              [readonly]="true"
            />
            <ng-container *ngIf="contractor.invalid && contractor.touched">
              <p
                class="caption status-danger"
                *ngIf="contractor.errors?.required"
              >
                O nome do cliente é obrigatório!
              </p>
              <p
                class="caption status-danger"
                *ngIf="
                  contractor.errors?.minlength || contractor.errors?.maxlength
                "
              >
                O nome do cliente deve conter entre
                {{ validation.contractor.minLength }} a
                {{ validation.contractor.maxLength }}
                caracteres
              </p>
            </ng-container>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="input-administration">
              Administração do contrato:
            </label>
            <nb-select
              [ngModel]="invoiceAdministration"
              #administration="ngModel"
              id="input-administration"
              name="administration"
              placeholder="Selecione o tipo de administração"
              fullWidth
              size="large"
              [disabled]="true"
              [status]="
                administration.dirty
                  ? administration.invalid
                    ? 'danger'
                    : 'success'
                  : 'basic'
              "
              [attr.aria-invalid]="
                administration.invalid && administration.touched ? true : null
              "
            >
              <nb-option value="nortan">Suporte Empresarial</nb-option>
              <nb-option value="pessoal">Intermediação de Negócios</nb-option>
            </nb-select>
          </div>
        </div>
      </div>

      <div class="form-control-group">
        <label class="label" for="input-name">Empreendimento:</label>
        <input
          nbInput
          [(ngModel)]="contract.name"
          #name="ngModel"
          id="input-name"
          name="name"
          placeholder="Nome do empreendimento"
          fullWidth
          fieldSize="large"
          [required]="validation.name.required"
          [status]="
            name.dirty ? (name.invalid ? 'danger' : 'success') : 'basic'
          "
          [attr.aria-invalid]="name.invalid && name.touched ? true : null"
          [readonly]="true"
        />
        <ng-container *ngIf="name.invalid && name.touched">
          <p class="caption status-danger" *ngIf="name.errors?.required">
            O nome do empreendimento é obrigatório!
          </p>
          <p
            class="caption status-danger"
            *ngIf="name.errors?.minlength || name.errors?.maxlength"
          >
            O nome do empreendimento deve conter entre
            {{ validation.name.minLength }} a
            {{ validation.name.maxLength }}
            caracteres
          </p>
        </ng-container>
      </div>
      <div class="row">
        <div class="col-6 col-md-3">
          <div class="form-control-group">
            <label class="label" for="input-value">Valor do contrato:</label>
            <input
              nbInput
              [ngModel]="contract.value"
              #value="ngModel"
              id="input-value"
              name="value"
              placeholder="Valor do contrato"
              fullWidth
              fieldSize="large"
              [readonly]="true"
            />
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="form-control-group">
            <label class="label" for="input-liquid">
              Valor liquido:
              <nb-icon
                status="info"
                icon="info"
                pack="eva"
                [options]="{ animation: { type: 'pulse' } }"
                nbTooltip="As porcentagens da NF e Nortan são calculadas automaticamente como exibido no balanço. Para alterar a porcentagem da Nortan é necessário criar uma OE com a porcentagem alterada."
                nbTooltipPlacement="top"
                nbTooltipStatus="info"
              ></nb-icon>
            </label>
            <input
              nbInput
              [ngModel]="contract.liquid"
              #liquid="ngModel"
              id="input-liquid"
              name="liquid"
              placeholder="Valor do contrato"
              fullWidth
              fieldSize="large"
              [readonly]="true"
            />
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="form-control-group">
            <label class="label" for="input-created">Data de criação:</label>
            <input
              nbInput
              [(ngModel)]="contract.created"
              #created="ngModel"
              id="input-created"
              name="created"
              placeholder="Escolha uma data"
              fullWidth
              fieldSize="large"
              (ngModelChange)="contract.lastUpdate = today"
              [nbDatepicker]="datepicker"
              [required]="validation.created.required"
              [status]="
                created.dirty
                  ? created.invalid
                    ? 'danger'
                    : 'success'
                  : 'basic'
              "
              [attr.aria-invalid]="
                created.invalid && created.touched ? true : null
              "
              [readonly]="true"
            />
            <nb-datepicker #datepicker [max]="today"></nb-datepicker>
          </div>
        </div>
        <div class="col-6 col-md-3">
          <div class="form-control-group">
            <label class="label" for="input-updated">Última atualização:</label>
            <input
              nbInput
              [ngModel]="utils.formatDate(contract.lastUpdate)"
              #updated="ngModel"
              id="input-updated"
              name="updated"
              placeholder="Escolha uma data"
              fullWidth
              fieldSize="large"
              [required]="validation.lastUpdate.required"
              [status]="
                updated.dirty
                  ? updated.invalid
                    ? 'danger'
                    : 'success'
                  : 'basic'
              "
              [attr.aria-invalid]="
                updated.invalid && updated.touched ? true : null
              "
              [readonly]="true"
            />
          </div>
        </div>
        <div class="col-12 col-md-3">
          <div class="form-control-group">
            <label class="label" for="input-user">
              Colaborador:
              <nb-icon
                status="info"
                icon="info"
                pack="eva"
                [options]="{ animation: { type: 'pulse' } }"
                nbTooltip="Adicione as % de recebimento de cada membro do contrato para que a ordem de empenho seja calculada automaticamente."
                nbTooltipPlacement="top"
                nbTooltipStatus="info"
              ></nb-icon>
            </label>
            <nb-completer
              [(ngModel)]="userSearch"
              [inputName]="'userListCompleter'"
              (selected)="
                teamMember.user = $event;
                USER_COORDINATIONS = departmentService.userCoordinations(
                  teamMember.user._id
                );
                teamMember.coordination = undefined
              "
              #userList="ngModel"
              id="input-user"
              name="userList"
              nameField="fullName"
              pictureField="profilePicture"
              [data$]="availableUsers"
              [minSearchLength]="0"
              [placeholder]="'Digite e selecione o nome do colaborador'"
              [textNoResults]="
                'Não foi possível achar um colaborador com o nome digitado'
              "
              [fullWidth]="true"
              [fieldSize]="'large'"
              [status]="
                userList.dirty && userSearch
                  ? userList.invalid
                    ? 'danger'
                    : 'success'
                  : 'basic'
              "
              [attr.aria-invalid]="
                userList.invalid && userList.touched ? true : null
              "
            ></nb-completer>
          </div>
        </div>
        <div class="col-6 col-md-2">
          <div class="form-control-group">
            <label class="label" for="input-memberCoordination">
              Coordenação:
            </label>
            <nb-select
              [(ngModel)]="teamMember.coordination"
              #memberCoordination="ngModel"
              id="input-memberCoordination"
              name="memberCoordination"
              placeholder="Coordenação"
              fullWidth
              size="large"
              [status]="memberCoordination.value ? 'success' : 'basic'"
              [attr.aria-invalid]="
                memberCoordination.invalid && memberCoordination.touched
                  ? true
                  : null
              "
            >
              <nb-option
                *ngFor="let coordination of USER_COORDINATIONS"
                [value]="coordination"
              >
                {{ coordination.split(' ')[0] }}
              </nb-option>
            </nb-select>
          </div>
        </div>
        <div class="col-6 col-md-2">
          <div class="form-control-group">
            <label class="label" for="input-gross-value">R$ Bruto:</label>
            <input
              nbInput
              [ngModel]="teamMember.grossValue"
              #grossValue="ngModel"
              id="input-grossValue"
              name="grossValue"
              placeholder="Valor bruto"
              fullWidth
              fieldSize="large"
              readonly="true"
              [status]="grossValue.value ? 'success' : 'basic'"
              [attr.aria-invalid]="
                grossValue.invalid && grossValue.touched ? true : null
              "
            />
          </div>
        </div>
        <div class="col-6 col-md-2">
          <div class="form-control-group">
            <label class="label" for="input-net-value">R$ Líquido:</label>
            <input
              nbInput
              [(ngModel)]="teamMember.netValue"
              (ngModelChange)="updatePercentage()"
              #netValue="ngModel"
              id="input-netValue"
              name="netValue"
              placeholder="Valor líquido"
              fullWidth
              fieldSize="large"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              [status]="netValue.value ? 'success' : 'basic'"
              [attr.aria-invalid]="
                netValue.invalid && netValue.touched ? true : null
              "
            />
          </div>
        </div>
        <div class="col-6 col-md-2">
          <div class="form-control-group">
            <label class="label" for="input-paid">Distribuição:</label>
            <input
              nbInput
              [(ngModel)]="teamMember.distribution"
              (ngModelChange)="updateValue()"
              #distribution="ngModel"
              id="input-distribution"
              name="distribution"
              placeholder="Porcentagem distribuida"
              fullWidth
              fieldSize="large"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              [status]="distribution.value ? 'success' : 'basic'"
              [attr.aria-invalid]="
                distribution.invalid && distribution.touched ? true : null
              "
            />
          </div>
        </div>
        <div class="col-12 col-md-1">
          <button
            nbButton
            type="button"
            fullWidth
            status="primary"
            size="large"
            style="margin-top: 28px"
            [disabled]="
              !memberCoordination.value || !userList.value || !netValue.value
            "
            (click)="addColaborator()"
          >
            +
          </button>
        </div>
        <nb-list style="width: 100%; padding: 10px 0">
          <nb-list-item
            *ngFor="
              let member of contract.team;
              let i = index;
              trackBy: utils.trackByIndex
            "
          >
            <div class="row irow">
              <div class="col-12 col-md-3 list-name">
                {{ member.user ? userService.idToShortName(member.user) : '' }}
              </div>
              <div class="col-6 col-md-2">
                <nb-select
                  [(ngModel)]="contract.team[i].coordination"
                  id="input-memberCoordination-{{ i }}"
                  name="memberCoordination-{{ i }}"
                  placeholder="Coordenação"
                  fullWidth
                >
                  <nb-option
                    *ngFor="
                      let coordination of departmentService.userCoordinations(
                        contract.team[i].user
                      )
                    "
                    [value]="coordination"
                  >
                    {{ coordination.split(' ')[0] }}
                  </nb-option>
                </nb-select>
              </div>
              <div class="col-6 col-md-2">
                <input
                  nbInput
                  [ngModel]="contract.team[i].grossValue"
                  id="input-gross-value-{{ i }}"
                  name="gross-value-{{ i }}"
                  placeholder="Valor bruto"
                  fullWidth
                  readonly="true"
                  [status]="contract.team[i].grossValue ? 'basic' : 'danger'"
                />
              </div>
              <div class="col-6 col-md-2">
                <input
                  nbInput
                  [(ngModel)]="contract.team[i].netValue"
                  (ngModelChange)="updatePercentage(i)"
                  id="input-net-value-{{ i }}"
                  name="net-value-{{ i }}"
                  placeholder="Valor líquido"
                  fullWidth
                  [brmasker]="{
                    money: true,
                    thousand: '.',
                    decimalCaracter: ',',
                    decimal: 2
                  }"
                  [status]="contract.team[i].netValue ? 'basic' : 'danger'"
                />
              </div>
              <div
                class="col-6 col-md-2"
                style="display: flex; align-items: center"
              >
                <input
                  nbInput
                  [(ngModel)]="contract.team[i].distribution"
                  (ngModelChange)="updateValue(i)"
                  id="input-distribution-{{ i }}"
                  name="distribution-{{ i }}"
                  placeholder="Porcentagem distribuida"
                  fullWidth
                  [brmasker]="{
                    money: true,
                    thousand: '.',
                    decimalCaracter: ',',
                    decimal: 2
                  }"
                  [status]="contract.team[i].distribution ? 'basic' : 'danger'"
                />
                %
              </div>
              <div class="col-12 col-md-1 list-erase">
                <nb-icon
                  class="xIcon"
                  status="basic"
                  icon="trash-2-outline"
                  pack="eva"
                  (click)="
                    contract.team.splice(i, 1);
                    updateTeamTotal();
                    memberChanged$.next(true)
                  "
                  [options]="{ animation: { type: 'shake' } }"
                ></nb-icon>
              </div>
            </div>
          </nb-list-item>
          <nb-list-item *ngIf="!utils.isPhone()">
            <div class="row irow totalRow">
              <div class="col-2">
                Restante:
                {{
                  stringUtil.subtractMoney(contract.liquid, teamTotal.netValue)
                }}
              </div>
              <div class="col-3" style="text-align: right">Total:</div>
              <div
                class="col-2"
                [ngClass]="{
                  danger: !isGrossValueOK(),
                  success: isGrossValueOK()
                }"
              >
                R$ {{ teamTotal.grossValue }}
              </div>
              <div
                class="col-2"
                [ngClass]="{
                  danger: !isNetValueOK(),
                  success: isNetValueOK()
                }"
              >
                R$ {{ teamTotal.netValue }}
              </div>
              <div
                class="col-2"
                [ngClass]="{
                  danger: teamTotal.distribution != '0,00',
                  success: teamTotal.distribution == '100,00'
                }"
              >
                {{ teamTotal.distribution }}%
              </div>
              <div class="col-1"></div>
            </div>
          </nb-list-item>
        </nb-list>
        <div class="col-6">
          <div class="form-control-group">
            <label class="label" for="input-hasISS">
              Houve retenção de ISS?:
            </label>
            <nb-select
              [(ngModel)]="options.hasISS"
              #hasISS="ngModel"
              id="input-hasISS"
              name="hasISS"
              placeholder="hasISS"
              fullWidth
              size="large"
              [required]="validation.hasISS?.required"
              [status]="
                hasISS.dirty ? (hasISS.invalid ? 'danger' : 'success') : 'basic'
              "
              [attr.aria-invalid]="
                hasISS.invalid && hasISS.touched ? true : null
              "
              (selectedChange)="
                contract.ISS = hasISS.value ? iss.value : '0,00'; updateLiquid()
              "
            >
              <nb-option [value]="true">Sim</nb-option>
              <nb-option [value]="false">Não</nb-option>
            </nb-select>
          </div>
        </div>
        <div class="col-6">
          <div class="form-control-group">
            <label class="label" for="input-iss">Alíquota do ISS:</label>
            <input
              nbInput
              [(ngModel)]="contract.ISS"
              #iss="ngModel"
              id="input-iss"
              name="iss"
              placeholder="Alíquota"
              fullWidth
              fieldSize="large"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              [disabled]="!hasISS.value"
              [required]="validation.ISS?.required"
              [status]="
                iss.dirty ? (iss.invalid ? 'danger' : 'success') : 'basic'
              "
              [attr.aria-invalid]="iss.invalid && iss.touched ? true : null"
              (ngModelChange)="updateLiquid()"
            />
          </div>
        </div>
        <div class="col-6 col-md-4">
          <div class="form-control-group">
            <label class="label" for="input-balance">Caixa:</label>
            <input
              nbInput
              [(ngModel)]="contract.balance"
              #balance="ngModel"
              id="input-balance"
              name="balance"
              placeholder="Balanço do contrato"
              fullWidth
              fieldSize="large"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              [required]="validation.balance?.required"
              [status]="
                balance.invalid || contract.balance[0] == '-'
                  ? 'danger'
                  : 'basic'
              "
              [attr.aria-invalid]="
                balance.invalid && balance.touched ? true : null
              "
              [readonly]="true"
            />
          </div>
        </div>
        <div class="col-6 col-md-4">
          <div class="form-control-group">
            <label class="label" for="input-paid">Valor pago:</label>
            <input
              nbInput
              [(ngModel)]="options.paid"
              #paid="ngModel"
              id="input-paid"
              name="paid"
              placeholder="Valor pago"
              fullWidth
              fieldSize="large"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              [required]="validation.paid?.required"
              [status]="
                paid.dirty ? (paid.invalid ? 'danger' : 'success') : 'basic'
              "
              [attr.aria-invalid]="paid.invalid && paid.touched ? true : null"
              [readonly]="true"
            />
          </div>
        </div>
        <div class="col-6 col-md-2">
          <div class="form-control-group">
            <label class="label" for="input-interest">Parcelas criadas:</label>
            <input
              nbInput
              [(ngModel)]="options.interest"
              #interest="ngModel"
              id="input-interest"
              name="interest"
              placeholder="Parcelas pagas"
              fullWidth
              fieldSize="large"
              [required]="validation.interest?.required"
              [minlength]="validation.interest?.minLength"
              [maxlength]="validation.interest?.maxLength"
              [status]="
                interest.dirty
                  ? interest.invalid
                    ? 'danger'
                    : 'success'
                  : 'basic'
              "
              [attr.aria-invalid]="
                interest.invalid && interest.touched ? true : null
              "
              [readonly]="true"
            />
          </div>
        </div>
        <div class="col-6 col-md-2">
          <div class="form-control-group">
            <label class="label" for="input-total">Parcelas totais:</label>
            <nb-select
              [(ngModel)]="contract.total"
              #total="ngModel"
              id="input-total"
              name="total"
              placeholder="Total"
              fullWidth
              size="large"
              [required]="validation.total?.required"
              [status]="
                total.dirty ? (total.invalid ? 'danger' : 'success') : 'basic'
              "
              [attr.aria-invalid]="total.invalid && total.touched ? true : null"
            >
              <nb-option *ngFor="let interest of INTERESTS" [value]="interest">
                {{ interest }}
              </nb-option>
            </nb-select>
          </div>
        </div>
      </div>
      <button
        nbButton
        fullWidth
        status="primary"
        size="large"
        [disabled]="!form.valid"
      >
        Atualizar
      </button>
    </form>
  </nb-tab>
  <nb-tab
    [tabTitle]="utils.isPhone() ? '' : 'Balanço'"
    [tabIcon]="scaleIcon"
    responsive
  >
    <div class="row">
      <div class="col-auto">
        <label class="label-divider">Geral</label>
      </div>
      <div class="col">
        <hr />
      </div>
    </div>
    <div class="row" style="text-align: center">
      <div class="col-6 col-md">
        <div class="form-control-group">
          <label class="label" for="input-nf">NF(%)</label>
          <p>
            <b>{{ options.notaFiscal }}</b>
          </p>
        </div>
      </div>
      <div class="col-6 col-md">
        <div class="form-control-group">
          <label class="label" for="input-nortan">Nortan(%)</label>
          <p>
            <b>{{ options.nortanPercentage }}</b>
          </p>
        </div>
      </div>
      <div class="col-md">
        <div class="form-control-group">
          <label class="label" for="input-liquid">Contrato Bruto</label>
          <p>
            <b>
              {{
                contractService.subtractComissions(
                  stringUtil.removePercentage(contract.value, contract.ISS),
                  contract
                )
              }}
            </b>
          </p>
        </div>
      </div>
      <div class="col-md">
        <div class="form-control-group">
          <label class="label" for="input-liquid">Contrato liquído</label>
          <p>
            <b>{{ contract.liquid }}</b>
          </p>
        </div>
      </div>
      <div class="col-md">
        <div class="form-control-group">
          <label class="label" for="input-liquid">Cashback</label>
          <p>
            <b>{{ contract.cashback }}</b>
          </p>
        </div>
      </div>
      <div class="col-md">
        <div class="form-control-group">
          <label class="label" for="input-value">Saldo do contrato</label>
          <p>
            <b>{{ contract.notPaid }}</b>
          </p>
        </div>
      </div>
    </div>
    <nb-list style="width: 100%; padding: 10px 0; text-align: center">
      <nb-list-item class="noPadding">
        <div class="row irow">
          <div class="col-12 col-md-3"><b>Colaborador</b></div>
          <div class="col-6 col-md-2"><b>R$ Bruto</b></div>
          <div class="col-6 col-md-2"><b>R$ Líquido</b></div>
          <div class="col-4 col-md-1"><b>%</b></div>
          <div class="col-4 col-md-2"><b>Recebido</b></div>
          <div class="col-4 col-md-2"><b>Saldo</b></div>
        </div>
      </nb-list-item>
      <nb-list-item
        *ngFor="
          let member of contract.team;
          let i = index;
          trackBy: utils.trackByIndex
        "
      >
        <div class="row irow">
          <div class="col-12 col-md-3">
            {{ userService.idToName(member.user) }}
          </div>
          <div class="col-6 col-md-2">
            {{
              contractService.toGrossValue(
                contractService.netValueBalance(
                  member.distribution,
                  contract,
                  member.user
                ),
                options.notaFiscal,
                options.nortanPercentage
              )
            }}
          </div>
          <div class="col-6 col-md-2">
            {{
              contractService.netValueBalance(
                member.distribution,
                contract,
                member.user
              )
            }}
          </div>
          <div class="col-4 col-md-1">
            {{
              contractService.percentageToReceive(
                member.distribution,
                member.user,
                contract
              )
            }}
          </div>
          <div class="col-4 col-md-2">
            {{ contractService.receivedValue(member.user, contract) }}
          </div>
          <div class="col-4 col-md-2">
            {{
              contractService.notPaidValue(
                member.distribution,
                member.user,
                contract
              )
            }}
          </div>
        </div>
      </nb-list-item>
    </nb-list>
    <div class="row" style="text-align: center">
      <div class="col-md">
        <div class="form-control-group">
          <label class="label" for="input-balance">Caixa:</label>
          <p
            [ngClass]="{
              success: contract.balance[0] != '-',
              danger: contract.balance[0] == '-'
            }"
          >
            {{ contract.balance }}
          </p>
        </div>
      </div>
      <div class="col-md">
        <div class="form-control-group">
          <label class="label" for="input-paid">Valor pago:</label>
          <p>{{ options.paid }}</p>
        </div>
      </div>
      <div class="col-md">
        <div class="form-control-group">
          <label class="label" for="input-interest">Parcelas criadas:</label>
          <p>{{ options.interest }}</p>
        </div>
      </div>
      <div class="col-md">
        <div class="form-control-group">
          <label class="label" for="input-total">Parcelas totais:</label>
          <p>{{ contract.total }}</p>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-auto">
        <label class="label-divider">Despesas</label>
      </div>
      <div class="col">
        <hr />
      </div>
    </div>
    <div class="row" style="text-align: center">
      <div class="col-md-6">
        <div class="form-control-group">
          <nb-list style="width: 100%; padding: 10px 0; text-align: center">
            <nb-list-item
              *ngFor="
                let expense of expenseTypesSum();
                let i = index;
                trackBy: utils.trackByIndex
              "
            >
              <div class="row irow">
                <div class="col-md-6">
                  <b>{{ expense.type }}</b>
                </div>
                <div class="col-md-6">
                  {{ expense.value }}
                </div>
              </div>
            </nb-list-item>
          </nb-list>
        </div>
      </div>
      <div class="col-md-6">
        <div class="form-control-group">
          <nb-list style="width: 100%; padding: 10px 0; text-align: center">
            <nb-list-item
              *ngFor="
                let expense of expenseSourceSum();
                let i = index;
                trackBy: utils.trackByIndex
              "
            >
              <div class="row irow">
                <div class="col-md-6">
                  <b>{{ expense.user }}</b>
                </div>
                <div class="col-md-6">
                  {{ expense.value }}
                </div>
              </div>
            </nb-list-item>
          </nb-list>
        </div>
      </div>
    </div>
  </nb-tab>
  <nb-tab
    [tabTitle]="utils.isPhone() ? '' : 'Ordens de empenho'"
    [tabIcon]="receiptIcon"
    responsive
  >
    <nb-list>
      <nb-list-item *ngFor="let receipt of contract.receipts; let i = index">
        <div class="row irow" style="width: 100%">
          <div class="col-10 col-md-11">
            <div class="irow row">
              <a
                (click)="paymentDialog(types.RECEIPT, i)"
                style="width: 100%; cursor: pointer; display: flex"
              >
                <div class="col-1">#{{ +i + 1 }}</div>
                <div class="col">
                  {{ receipt.description }}
                </div>
                <div class="col-md-3">
                  <nb-icon
                    icon="dollar-sign"
                    pack="fa"
                    status="success"
                  ></nb-icon>
                  <span style="vertical-align: 0.1em">
                    {{ receipt.value }}
                  </span>
                </div>
              </a>
            </div>
          </div>
          <div class="col-2 col-md-1" style="text-align: right">
            <nb-icon
              class="xIcon"
              status="basic"
              icon="trash-2-outline"
              pack="eva"
              (click)="confirmationDialog(i, types.RECEIPT)"
              [options]="{ animation: { type: 'shake' } }"
            ></nb-icon>
          </div>
        </div>
      </nb-list-item>
    </nb-list>
    <button
      nbButton
      fullWidth
      status="primary"
      size="large"
      [disabled]="contract.receipts.length == +contract.total"
      (click)="paymentDialog(types.RECEIPT)"
    >
      Nova Ordem de Empenho
    </button>
  </nb-tab>
  <nb-tab
    [tabTitle]="utils.isPhone() ? '' : 'Ordens de pagamento'"
    [tabIcon]="paymentIcon"
    responsive
  >
    <nb-list>
      <nb-list-item *ngFor="let payment of contract.payments; let i = index">
        <div class="row irow" style="width: 100%">
          <div class="col-10 col-md-11">
            <div class="irow row">
              <a
                (click)="paymentDialog(types.PAYMENT, i)"
                style="width: 100%; cursor: pointer; display: flex"
              >
                <div class="col-1">#{{ +i + 1 }}</div>
                <div class="col">
                  {{ payment.service }}
                </div>
                <div class="col-md-3">
                  <nb-icon
                    icon="dollar-sign"
                    pack="fa"
                    status="success"
                  ></nb-icon>
                  <span style="vertical-align: 0.1em">
                    {{ payment.value }}
                  </span>
                </div>
              </a>
            </div>
          </div>
          <div class="col-2 col-md-1" style="text-align: right">
            <nb-icon
              class="xIcon"
              status="basic"
              icon="trash-2-outline"
              pack="eva"
              (click)="confirmationDialog(i, types.PAYMENT)"
              [options]="{ animation: { type: 'shake' } }"
            ></nb-icon>
          </div>
        </div>
      </nb-list-item>
    </nb-list>
    <button
      nbButton
      fullWidth
      status="primary"
      size="large"
      (click)="paymentDialog(types.PAYMENT)"
    >
      Nova Ordem de Pagamento
    </button>
  </nb-tab>
  <nb-tab
    [tabTitle]="utils.isPhone() ? '' : 'Despesas'"
    [tabIcon]="expenseIcon"
    responsive
  >
    <ng2-smart-table
      #smartTable
      *ngIf="!utils.isPhone(); else phone"
      [settings]="settings"
      [source]="source"
      (create)="paymentDialog(types.EXPENSE)"
      (edit)="paymentDialog(types.EXPENSE, expenseIndex($event.data.code))"
      (delete)="
        confirmationDialog(expenseIndex($event.data.code), types.EXPENSE)
      "
    ></ng2-smart-table>
    <ng-template #phone>
      <div class="row">
        <div class="col-2" style="padding-left: 0; padding-right: 0">
          <button
            nbButton
            fullWidth
            status="primary"
            style="height: 100%"
            (click)="paymentDialog(types.EXPENSE)"
          >
            <i class="nb-plus" style="font-size: 1.5rem"></i>
          </button>
        </div>
        <div class="col-10">
          <input
            nbInput
            [(ngModel)]="searchQuery"
            #search="ngModel"
            id="input-search"
            name="search"
            placeholder="Busque aqui..."
            fullWidth
            fieldSize="large"
          />
        </div>
      </div>
      <nb-list>
        <nb-list-item *ngFor="let expense of filtredExpenses; let i = index">
          <div class="row irow" style="width: 100%">
            <div class="col-10 col-md-11">
              <div class="irow row">
                <a
                  (click)="paymentDialog(types.EXPENSE, i)"
                  style="
                    width: 100%;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                  "
                >
                  <div class="col-auto">
                    <nb-user
                      [onlyPicture]="true"
                      [name]="userService.idToName(expense.author)"
                      [picture]="userService.profilePicture(expense.author)"
                    ></nb-user>
                  </div>
                  <div class="col-auto">#{{ +i + 1 }}</div>
                  <div class="col">
                    {{ expense.description }}
                  </div>
                  <div class="col-md-auto">
                    <nb-icon
                      icon="dollar-sign"
                      pack="fa"
                      status="success"
                    ></nb-icon>
                    <span style="vertical-align: 0.1em">
                      {{ expense.value }}
                    </span>
                  </div>
                  <div class="col-md-auto">
                    <nb-icon
                      icon="calendar-alt"
                      pack="fa"
                      status="primary"
                    ></nb-icon>
                    <span style="vertical-align: 0.1em">
                      {{ utils.formatDate(expense.created) }}
                    </span>
                  </div>
                </a>
              </div>
            </div>
            <div class="col-2 col-md-auto" style="text-align: right">
              <nb-icon
                class="xIcon"
                status="basic"
                icon="trash-2-outline"
                pack="eva"
                (click)="confirmationDialog(i, types.EXPENSE)"
                [options]="{ animation: { type: 'shake' } }"
              ></nb-icon>
            </div>
          </div>
        </nb-list-item>
      </nb-list>
    </ng-template>
  </nb-tab>
</nb-tabset>
