<form #form="ngForm" aria-labelledby="title">
  <nb-tabset fullWidth>
    <nb-tab tabTitle="Principal">
      <div class="row">
        <div class="col-12" *ngIf="editing ? true : !!(accessChecker.isGranted('aer', 'invoice-author') | async)">
          <div class="form-control-group">
            <label class="label" for="input-author">Gestor:</label>
            <nb-completer
              [(ngModel)]="authorSearch"
              [inputName]="'authorListCompleter'"
              (selected)="tempInvoice.author = $event; tempInvoice.team[0].user = $event"
              #authorList="ngModel"
              id="input-author"
              name="authorList"
              nameField="fullName"
              pictureField="profilePicture"
              [data$]="authorData"
              [minSearchLength]="0"
              [placeholder]="'Digite e selecione o nome do colaborador do orçamento'"
              [textNoResults]="'Não foi possível achar um colaborador com o nome digitado'"
              [fullWidth]="true"
              [fieldSize]="'large'"
              [required]="validation.author.required"
              [status]="authorList.dirty && authorSearch ? (authorList.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="authorList.invalid && authorList.touched ? true : null"
              [disabled]="isInputDisabled$.value"
            ></nb-completer>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="input-nortan-team">Time:</label>
            <nb-select
              [(ngModel)]="tempInvoice.nortanTeam"
              #nortanTeam="ngModel"
              id="input-nortan-team"
              name="nortan-team"
              placeholder="Selecione o time"
              fullWidth
              size="large"
              [required]="validation.nortanTeam.required"
              [status]="nortanTeam.dirty ? (nortanTeam.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="nortanTeam.invalid && nortanTeam.touched ? true : null"
              [disabled]="editing"
              (selectedChange)="onNortanTeamChange()"
            >
              <nb-option *ngFor="let nTeam of NORTAN_TEAMS" [value]="nTeam._id">
                {{ nTeam.abrev }} - {{ nTeam.name }}
              </nb-option>
            </nb-select>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="input-sector">Setor:</label>
            <nb-select
              [(ngModel)]="tempInvoice.sector"
              (ngModelChange)="tempInvoice.team[0].sector = $event"
              #sector="ngModel"
              id="input-sector"
              name="sector"
              placeholder="Selecione o setor"
              fullWidth
              size="large"
              [required]="validation.sector.required"
              [status]="sector.dirty ? (sector.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="sector.invalid && sector.touched ? true : null"
              [disabled]="false"
            >
              <nb-option *ngFor="let sector of SECTORS" [value]="sector._id">
                {{ sector.abrev }} - {{ sector.name }}
              </nb-option>
            </nb-select>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="input-code">Código do orçamento:</label>
            <input
              nbInput
              [(ngModel)]="tempInvoice.code"
              #code="ngModel"
              id="input-code"
              name="code"
              placeholder="Código do Orçamento"
              fullWidth
              fieldSize="large"
              [required]="validation.code.required"
              [minlength]="validation.code.minLength"
              [maxlength]="validation.code.maxLength"
              [status]="code.dirty ? (code.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="code.invalid && code.touched ? true : null"
              [disabled]="true"
            />
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="input-administration">Administração do contrato:</label>
            <nb-select
              [(ngModel)]="tempInvoice.administration"
              (ngModelChange)="updateNetValue()"
              #administration="ngModel"
              id="input-administration"
              name="administration"
              placeholder="Selecione o tipo de administração"
              fullWidth
              size="large"
              [required]="validation.administration.required"
              [status]="administration.dirty ? (administration.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="administration.invalid && administration.touched ? true : null"
            >
              <nb-option value="nortan">Suporte Empresarial</nb-option>
              <nb-option value="pessoal">Intermediação de Negócios</nb-option>
            </nb-select>
          </div>
        </div>
      </div>

      <div class="form-control-group">
        <label class="label" for="input-type">Tipologia do empreendimento:</label>
        <input
          nbInput
          [(ngModel)]="tempInvoice.type"
          #type="ngModel"
          id="input-type"
          name="type"
          placeholder="Tipologia do contrato"
          fullWidth
          autofocus
          fieldSize="large"
          [required]="validation.type.required"
          [minlength]="validation.type.minLength"
          [maxlength]="validation.type.maxLength"
          [status]="type.dirty ? (type.invalid ? 'danger' : 'success') : 'basic'"
          [attr.aria-invalid]="type.invalid && type.touched ? true : null"
          [disabled]="false"
        />
        <ng-container *ngIf="type.invalid && type.touched">
          <p class="caption status-danger" *ngIf="type.errors?.required">
            A tipologia do empreendimento é obrigatória!
          </p>
          <p class="caption status-danger" *ngIf="type.errors?.minlength || type.errors?.maxlength">
            A tipologia do empreendimento deve conter entre
            {{ validation.type.minLength }} a
            {{ validation.type.maxLength }}
            caracteres
          </p>
        </ng-container>
      </div>

      <div class="form-control-group">
        <label class="label" for="input-service">Serviço:</label>
        <textarea
          nbInput
          [(ngModel)]="tempInvoice.service"
          #service="ngModel"
          id="input-service"
          name="service"
          placeholder="Descreva o serviço a ser realizado"
          fullWidth
          fieldSize="large"
          [required]="validation.service.required"
          [minlength]="validation.service.minLength"
          [maxlength]="validation.service.maxLength"
          [status]="service.dirty ? (service.invalid ? 'danger' : 'success') : 'basic'"
          [attr.aria-invalid]="service.invalid && service.touched ? true : null"
          [disabled]="false"
        ></textarea>
        <ng-container *ngIf="service.invalid && service.touched">
          <p class="caption status-danger" *ngIf="service.errors?.required">A descrição do serviço é obrigatória!</p>
          <p class="caption status-danger" *ngIf="service.errors?.minlength || service.errors?.maxlength">
            A descrição do serviço deve conter entre
            {{ validation.service.minLength }} a
            {{ validation.service.maxLength }}
            caracteres
          </p>
        </ng-container>
      </div>

      <div class="row">
        <div class="col-9 col-md-11">
          <div class="form-control-group">
            <label class="label" for="input-contractor">Cliente:</label>
            <nb-completer
              [(ngModel)]="contractorSearch"
              [inputName]="'contractorCompleter'"
              (selected)="
                tempInvoice.contractor = $event;
                tempInvoice.contractorFullName = idToProperty(
                  tempInvoice.contractor,
                  contractorService.idToContractor.bind(contractorService),
                  'fullName'
                )
              "
              #contractor="ngModel"
              id="input-contractor"
              name="contractor"
              nameField="fullName"
              [data$]="contractorData"
              [minSearchLength]="0"
              [placeholder]="'Digite e selecione o nome do cliente do orçamento'"
              [textNoResults]="'Não foi possível achar um cliente com o nome digitado'"
              [fullWidth]="true"
              [fieldSize]="'large'"
              [isPhone]="isPhone()"
              [showAvatar]="false"
              [tooltipFunction]="tooltipText"
              [inputObject]="tempInvoice.contractor"
              [required]="validation.contractor.required"
              [status]="contractor.dirty ? (contractor.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="contractor.invalid && contractor.touched ? true : null"
            ></nb-completer>
            <ng-container *ngIf="contractor.invalid">
              <p class="caption status-danger" *ngIf="contractor.errors?.isTestUser">
                Para fechar o contrato é necessário selecionar um cliente diferente do cliente teste.
              </p>
            </ng-container>
          </div>
        </div>
        <div class="col-3 col-md-1">
          <div class="form-control-group">
            <button
              nbButton
              type="button"
              fullWidth
              status="primary"
              size="large"
              style="margin-top: 28px"
              nbTooltip="Adicionar cliente"
              [nbTooltipTrigger]="isPhone() ? tooltipTriggers.NOOP : tooltipTriggers.HINT"
              nbTooltipPlacement="top"
              nbTooltipStatus="info"
              (click)="addContractor()"
            >
              <nb-icon icon="person-add-outline"></nb-icon>
            </button>
          </div>
        </div>
      </div>

      <div class="form-control-group">
        <label class="label" for="input-associate">Prospectado por:</label>
        <nb-completer
          [(ngModel)]="associateSearch"
          [inputName]="'associateListCompleter'"
          (selected)="tempInvoice.prospectedBy = $event"
          #associateList="ngModel"
          id="input-associate"
          name="associate-list"
          nameField="fullName"
          pictureField="profilePicture"
          [data$]="associateData"
          [minSearchLength]="0"
          [placeholder]="'Digite e selecione o nome do associado'"
          [textNoResults]="'Não foi possível achar um associado com o nome digitado'"
          [fullWidth]="true"
          [fieldSize]="'large'"
          [status]="associateList.dirty && associateSearch ? (associateList.invalid ? 'danger' : 'success') : 'basic'"
          [attr.aria-invalid]="associateList.invalid && associateList.touched ? true : null"
        ></nb-completer>
      </div>

      <div class="form-control-group">
        <label class="label" for="input-name">Empreendimento:</label>
        <input
          nbInput
          [(ngModel)]="tempInvoice.name"
          #name="ngModel"
          id="input-name"
          name="name"
          placeholder="Nome do empreendimento"
          fullWidth
          fieldSize="large"
          [required]="validation.name.required"
          [minlength]="validation.name.minLength"
          [maxlength]="validation.name.maxLength"
          [status]="name.dirty ? (name.invalid ? 'danger' : 'success') : 'basic'"
          [attr.aria-invalid]="name.invalid && name.touched ? true : null"
          [disabled]="false"
        />
        <ng-container *ngIf="name.invalid && name.touched">
          <p class="caption status-danger" *ngIf="name.errors?.required">O nome do empreendimento é obrigatório!</p>
          <p class="caption status-danger" *ngIf="name.errors?.minlength || name.errors?.maxlength">
            O nome do empreendimento deve conter entre
            {{ validation.name.minLength }} a
            {{ validation.name.maxLength }}
            caracteres
          </p>
        </ng-container>
      </div>

      <div class="row">
        <div class="col-6">
          <div class="form-control-group">
            <label class="label" for="input-value">Valor bruto do contrato:</label>
            <input
              nbInput
              [(ngModel)]="tempInvoice.value"
              #value="ngModel"
              id="input-value"
              name="value"
              placeholder="Valor do contrato"
              fullWidth
              fieldSize="large"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              ngxSelectAllText
              [required]="validation.value.required"
              [minlength]="validation.value.minLength"
              [maxlength]="validation.value.maxLength"
              [status]="value.dirty ? (value.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="value.invalid && value.touched ? true : null"
              [disabled]="false"
              (focus)="updateLastValues()"
              (focusout)="updateLastValues()"
              (ngModelChange)="
                updateDependentValues(tempInvoice.stages, 'stage'); updateNetValue(); updateTotal('product')
              "
            />
            <ng-container *ngIf="value.invalid && value.touched">
              <p class="caption status-danger" *ngIf="value.errors?.required">O valor do contrato é obrigatório!</p>
              <p class="caption status-danger" *ngIf="value.errors?.minlength || value.errors?.maxlength">
                O valor do contrato deve conter entre
                {{ validation.value.minLength }} a
                {{ validation.value.maxLength }}
                numeros
              </p>
            </ng-container>
          </div>
        </div>

        <div class="col-6">
          <div class="form-control-group">
            <label class="label" for="input-net-value">Valor líquido do contrato:</label>
            <input
              nbInput
              [(ngModel)]="options.netValue"
              #netValue="ngModel"
              id="input-net-value"
              name="netValue"
              placeholder="Valor liquido do contrato"
              fullWidth
              fieldSize="large"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              ngxSelectAllText
              [required]="validation.value.required"
              [minlength]="validation.value.minLength"
              [maxlength]="validation.value.maxLength"
              [status]="netValue.dirty ? (netValue.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="netValue.invalid && netValue.touched ? true : null"
              (ngModelChange)="updateGrossValue(); updateDependentValues(tempInvoice.stages, 'stage')"
            />
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="input-status">Status:</label>
            <nb-select
              [(ngModel)]="tempInvoice.status"
              (ngModelChange)="forceValidatorUpdate(contractor)"
              #status="ngModel"
              id="input-status"
              name="status"
              placeholder="Selecione o status do orçamento"
              fullWidth
              size="large"
              [required]="validation.status.required"
              [status]="status.dirty ? (status.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="status.invalid && status.touched ? true : null"
              [disabled]="oldStatus == tStatus.FECHADO"
            >
              <nb-option *ngFor="let status of STATOOS" [value]="status">
                {{ status }}
              </nb-option>
            </nb-select>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label">
              <!-- TODO: Remover depois de adicionar data de criação para todos os orçamentos -->
              <!-- >{{ editing ? 'Última atualização' : 'Data de criação' }}:</label -->
              {{ 'Data de criação' }}:
            </label>
            <!-- TODO: Alterar ngIf para editing depois de adicionar data de criação dos orçamentos -->
            <input
              *ngIf="false; else datePicker"
              nbInput
              [(ngModel)]="tempInvoice.lastUpdate"
              #date="ngModel"
              id="input-date"
              name="date"
              placeholder="Escolha uma data"
              fullWidth
              fieldSize="large"
              [required]="validation.date.required"
              [status]="date.dirty ? (date.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="date.invalid && date.touched ? true : null"
              [readonly]="true"
            />
            <ng-template #datePicker>
              <input
                nbInput
                [(ngModel)]="tempInvoice.created"
                #date="ngModel"
                id="input-date"
                name="date"
                placeholder="Escolha uma data"
                fullWidth
                fieldSize="large"
                (ngModelChange)="fixHours()"
                [nbDatepicker]="datepicker"
                [required]="validation.date.required"
                [status]="date.dirty ? (date.invalid ? 'danger' : 'success') : 'basic'"
                [attr.aria-invalid]="date.invalid && date.touched ? true : null"
                [readonly]="true"
              />
              <nb-datepicker #datepicker [max]="today"></nb-datepicker>
            </ng-template>
          </div>
        </div>
      </div>
    </nb-tab>
    <nb-tab tabTitle="Complementar">
      <div *ngIf="config.hasType" class="row">
        <div class="col-auto">
          <label class="label-divider">Tipo de orçamento</label>
        </div>
        <div class="col">
          <hr />
        </div>
        <div class="col-12">
          <div class="form-control-group">
            <label class="label" for="input-invoice-type" style="display: flex; margin-top: 4px">
              <span style="margin-right: 10px">Tipo:</span>
              <nb-radio-group
                [(ngModel)]="tempInvoice.invoiceType"
                #invoiceType="ngModel"
                id="input-invoice-type"
                name="invoiceType"
                style="height: 16px"
              >
                <nb-radio value="projeto" style="height: 16px">Projeto</nb-radio>
                <nb-radio value="serviço" style="height: 16px">Serviço</nb-radio>
              </nb-radio-group>
            </label>
          </div>
        </div>
      </div>
      <div *ngIf="config.hasHeader" class="row">
        <div class="col-auto">
          <label class="label-divider">Cabeçalho</label>
        </div>
        <div class="col">
          <hr />
        </div>
      </div>
      <div *ngIf="config.hasHeader" class="form-control-group">
        <label class="label" for="input-subtitle1">Subtítulo linha 1:</label>
        <input
          nbInput
          [(ngModel)]="tempInvoice.subtitle1"
          #subtitle1="ngModel"
          id="input-subtitle1"
          name="subtitle1"
          placeholder="Digite os produtos do orçamento. ex: interiores + complementares"
          fullWidth
          fieldSize="large"
          [minlength]="validation.subtitle1.minLength"
          [maxlength]="validation.subtitle1.maxLength"
          [status]="subtitle1.dirty ? (subtitle1.invalid ? 'danger' : 'success') : 'basic'"
          [attr.aria-invalid]="subtitle1.invalid && subtitle1.touched ? true : null"
          [disabled]="false"
        />
        <ng-container *ngIf="subtitle1.invalid && subtitle1.touched">
          <p class="caption status-danger" *ngIf="subtitle1.errors?.minlength || subtitle1.errors?.maxlength">
            O subtítulo 1 deve conter entre
            {{ validation.subtitle1.minLength }} a
            {{ validation.subtitle1.maxLength }}
            caracteres
          </p>
        </ng-container>
      </div>
      <div *ngIf="config.hasHeader" class="form-control-group">
        <label class="label" for="input-subtitle2">Subtítulo linha 2:</label>
        <input
          nbInput
          [(ngModel)]="tempInvoice.subtitle2"
          #subtitle2="ngModel"
          id="input-subtitle2"
          name="subtitle2"
          placeholder="Continuação dos produtos (opcional)"
          fullWidth
          fieldSize="large"
          [minlength]="validation.subtitle2.minLength"
          [maxlength]="validation.subtitle2.maxLength"
          [status]="subtitle2.dirty ? (subtitle2.invalid ? 'danger' : 'success') : 'basic'"
          [attr.aria-invalid]="subtitle2.invalid && subtitle2.touched ? true : null"
          [disabled]="false"
        />
        <ng-container *ngIf="subtitle2.invalid && subtitle2.touched">
          <p class="caption status-danger" *ngIf="subtitle2.errors?.minlength || subtitle2.errors?.maxlength">
            O subtítulo 2 deve conter entre
            {{ validation.subtitle2.minLength }} a
            {{ validation.subtitle2.maxLength }}
            caracteres
          </p>
        </ng-container>
      </div>
      <div class="row" style="margin-top: 8px">
        <div class="col-auto">
          <label class="label-divider">Apresentação</label>
        </div>
        <div class="col">
          <hr />
        </div>
      </div>
      <div class="row">
        <div class="col-md-9">
          <div class="form-control-group">
            <label class="label" for="input-contactName">Primeiro nome do contato:</label>
            <input
              nbInput
              [(ngModel)]="tempInvoice.contactName"
              #contactName="ngModel"
              id="input-contactName"
              name="contactName"
              placeholder="Primeiro nome do contato na empresa"
              fullWidth
              fieldSize="large"
              [minlength]="validation.contactName.minLength"
              [maxlength]="validation.contactName.maxLength"
              [status]="contactName.dirty ? (contactName.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="contactName.invalid && contactName.touched ? true : null"
              [disabled]="false"
            />
            <ng-container *ngIf="contactName.invalid && contactName.touched">
              <p class="caption status-danger" *ngIf="contactName.errors?.minlength || contactName.errors?.maxlength">
                O nome do contato deve conter entre
                {{ validation.contactName.minLength }} a
                {{ validation.contactName.maxLength }}
                caracteres
              </p>
            </ng-container>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-control-group">
            <label class="label" for="input-contactPlural">Usar plural:</label>
            <div class="row">
              <div class="col-12">
                <nb-checkbox
                  [(ngModel)]="tempInvoice.contactPlural"
                  #contactPlural="ngModel"
                  name="contactPlural"
                  [status]="contactPlural.value ? 'success' : 'basic'"
                  style="top: 12px; position: relative"
                >
                  Tratar no plural
                </nb-checkbox>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-9">
          <div class="form-control-group">
            <label class="label" for="input-contractorName">Contratante:</label>
            <input
              nbInput
              [(ngModel)]="tempInvoice.contractorFullName"
              #contractorName="ngModel"
              id="input-contractorName"
              name="contractorName"
              placeholder="Primeiro nome do contato na empresa"
              fullWidth
              fieldSize="large"
              [minlength]="validation.contractorName.minLength"
              [maxlength]="validation.contractorName.maxLength"
              [status]="contractorName.dirty ? (contractorName.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="contractorName.invalid && contractorName.touched ? true : null"
              [disabled]="false"
            />
            <ng-container *ngIf="contractorName.invalid && contractorName.touched">
              <p
                class="caption status-danger"
                *ngIf="contractorName.errors?.minlength || contractorName.errors?.maxlength"
              >
                O nome do contratante deve conter entre
                {{ validation.contractorName.minLength }} a
                {{ validation.contractorName.maxLength }}
                caracteres
              </p>
            </ng-container>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-control-group">
            <label class="label" for="toggle-contractor" style="display: flex; margin-top: 4px">
              Quebra de página:
            </label>
            <nb-checkbox
              [(ngModel)]="tempInvoice.hasPageBreak.contractor"
              #contractorPageBreak="ngModel"
              name="contractorPageBreak"
              id="toggle-contractor"
              [status]="contractorPageBreak.value ? 'success' : 'basic'"
            >
              Adicionar quebra de página no PDF
            </nb-checkbox>
          </div>
        </div>
      </div>
      <div *ngIf="config.hasTeam" class="row">
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="input-user">Colaborador:</label>
            <nb-completer
              [(ngModel)]="userSearch"
              [inputName]="'userListCompleter'"
              (selected)="teamMember.user = $event; USER_SECTORS = teamService.userToSectors(teamMember.user)"
              #userList="ngModel"
              id="input-user"
              name="userList"
              nameField="fullName"
              pictureField="profilePicture"
              [data$]="availableUsers"
              [minSearchLength]="0"
              [placeholder]="'Digite e selecione o nome do colaborador do orçamento'"
              [textNoResults]="'Não foi possível achar um colaborador com o nome digitado'"
              [fullWidth]="true"
              [fieldSize]="'large'"
              [status]="userList.dirty && userSearch ? (userList.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="userList.invalid && userList.touched ? true : null"
            ></nb-completer>
          </div>
        </div>
        <div class="col-md-5">
          <div class="form-control-group">
            <label class="label" for="input-memberSector">Setor:</label>
            <nb-select
              [(ngModel)]="teamMember.sector"
              #memberSector="ngModel"
              id="input-member-sector"
              name="member-sector"
              placeholder="Setor"
              fullWidth
              size="large"
              [status]="memberSector.value?.length > 0 ? 'success' : 'basic'"
              [attr.aria-invalid]="memberSector.invalid && memberSector.touched ? true : null"
            >
              <nb-option *ngFor="let sector of USER_SECTORS" [value]="sector._id">
                {{ sector.abrev }} - {{ sector.name }}
              </nb-option>
            </nb-select>
          </div>
        </div>
        <div class="col-md-1">
          <button
            nbButton
            type="button"
            fullWidth
            status="primary"
            size="large"
            style="margin-top: 28px"
            [disabled]="!memberSector.value || !userList.value"
            (click)="addColaborator()"
          >
            +
          </button>
        </div>
      </div>
      <nb-list *ngIf="config.hasTeam" style="width: 100%; padding: 10px 0">
        <nb-list-item *ngFor="let member of tempInvoice.team; let i = index; trackBy: trackByIndex">
          <div class="row irow">
            <div class="col-12 col-md-6">
              {{ [member.user, userService.idToUser.bind(userService), 'fullName'] | transformPipe: idToProperty }}
            </div>
            <div class="col-10 col-md-5">
              <nb-select
                [(ngModel)]="tempInvoice.team[i].sector"
                [disabled]="i === 0"
                id="input-memberSector-{{ i }}"
                name="memberSector-{{ i }}"
                placeholder="Setor"
                fullWidth
              >
                <nb-option *ngFor="let sector of teamService.userToSectors(member.user)" [value]="sector._id">
                  {{ sector.abrev }} - {{ sector.name }}
                </nb-option>
              </nb-select>
            </div>
            <div class="col-2 col-md-1" style="text-align: right" *ngIf="i != 0">
              <nb-icon
                class="xIcon"
                status="basic"
                icon="trash-2-outline"
                pack="eva"
                (click)="tempInvoice.team.splice(i, 1); memberChanged$.next(true)"
                [options]="{ animation: { type: 'shake' } }"
              ></nb-icon>
            </div>
          </div>
        </nb-list-item>
      </nb-list>
      <div class="row">
        <div class="col-md-9">
          <div class="form-control-group">
            <label class="label" for="input-subject" style="width: 100%; display: flex; justify-content: space-between">
              Assunto: (Pontuação final necessária)
              <span>(Negrito: *!texto*)</span>
            </label>
            <textarea
              nbInput
              [(ngModel)]="tempInvoice.subject"
              #subject="ngModel"
              id="input-subject"
              name="subject"
              placeholder="Digite o assunto da proposta de orçamento. Para texto em negrito use os delimitadores *! *. ex: *!texto*"
              fullWidth
              fieldSize="large"
              [minlength]="validation.subject.minLength"
              [maxlength]="validation.subject.maxLength"
              [status]="subject.dirty ? (subject.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="subject.invalid && subject.touched ? true : null"
              [disabled]="false"
            ></textarea>
            <ng-container *ngIf="subject.invalid && subject.touched">
              <p class="caption status-danger" *ngIf="subject.errors?.minlength || subject.errors?.maxlength">
                O assunto deve conter entre
                {{ validation.subject.minLength }} a
                {{ validation.subject.maxLength }}
                caracteres
              </p>
            </ng-container>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-control-group">
            <label class="label" for="toggle-subject" style="display: flex; margin-top: 4px">Quebra de página:</label>
            <nb-checkbox
              [(ngModel)]="tempInvoice.hasPageBreak.subject"
              #subjectPageBreak="ngModel"
              name="subjectPageBreak"
              id="toggle-subject"
              [status]="subjectPageBreak.value ? 'success' : 'basic'"
            >
              Adicionar quebra de página no PDF
            </nb-checkbox>
            <button
            nbButton
            type="button"
            fullWidth
            status="primary"
            size="tiny"
            style="margin-top: 13px"
            (click)="copyTextInputService()"
          >
            Copiar texto do campo serviço
          </button>
          </div>
        </div>
      </div>
      <div *ngIf="config.hasPreliminary" class="row" style="margin-top: 8px">
        <div class="col-auto">
          <label class="label-divider">Etapa Preliminar</label>
        </div>
        <div class="col">
          <hr />
        </div>
      </div>
      <div class="row" *ngIf="config.hasPreliminary">
        <div class="form-control-group col-md-9">
          <label class="label" for="input-peep">Período de execução: (Já está entre parênteses)</label>
          <textarea
            nbInput
            [(ngModel)]="tempInvoice.peep"
            #peep="ngModel"
            id="input-peep"
            name="peep"
            placeholder="Digite o texto do período de execução"
            fullWidth
            fieldSize="large"
            [minlength]="validation.peep.minLength"
            [maxlength]="validation.peep.maxLength"
            [status]="peep.dirty ? (peep.invalid ? 'danger' : 'success') : 'basic'"
            [attr.aria-invalid]="peep.invalid && peep.touched ? true : null"
            [disabled]="false"
          ></textarea>
          <ng-container *ngIf="peep.invalid && peep.touched">
            <p class="caption status-danger" *ngIf="peep.errors?.minlength || peep.errors?.maxlength">
              O período de execução deve conter entre
              {{ validation.peep.minLength }} a
              {{ validation.peep.maxLength }}
              caracteres
            </p>
          </ng-container>
        </div>
        <div class="form-control-group col-md-3">
          <label class="label" for="toggle-preliminaryStage">Quebra de página</label>
          <br />
          <nb-checkbox
            [(ngModel)]="tempInvoice.hasPageBreak.preliminaryStage"
            #preliminaryStagePageBreak="ngModel"
            name="preliminaryStagePageBreak"
            id="toggle-preliminaryStage"
            [status]="preliminaryStagePageBreak.value ? 'success' : 'basic'"
          >
            Adicionar quebra de página no PDF
          </nb-checkbox>
        </div>
      </div>
      <div *ngIf="config.hasPreliminary" class="row">
        <div class="col-md-11">
          <div class="form-control-group">
            <label class="label" for="input-aep">Atividades: (Pontuação final automática)</label>
            <input
              nbInput
              [(ngModel)]="options.aep"
              #laep="ngModel"
              id="input-aep"
              name="laep"
              placeholder="Atividade"
              fullWidth
              fieldSize="large"
              [status]="laep.value ? 'success' : 'basic'"
              [attr.aria-invalid]="laep.invalid && laep.touched ? true : null"
            />
          </div>
        </div>
        <div *ngIf="config.hasPreliminary" class="col-md-1">
          <button
            nbButton
            type="button"
            fullWidth
            status="primary"
            size="large"
            style="margin-top: 28px"
            [disabled]="!laep.value"
            (click)="tempInvoice.laep.push({ text: options.aep, isVisible: true }); options.aep = ''"
          >
            +
          </button>
        </div>
      </div>
      <nb-list *ngIf="config.hasPreliminary" style="width: 100%; padding: 10px 0">
        <nb-list-item *ngFor="let activity of tempInvoice.laep; let i = index; trackBy: trackByIndex">
          <div class="row irow">
            <div class="col-10 col-md-11">
              <input
                nbInput
                [(ngModel)]="tempInvoice.laep[i].text"
                id="input-laepItem-{{ i }}"
                name="laepItem-{{ i }}"
                placeholder="atividade"
                fullWidth
                [status]="tempInvoice.laep[i].text.length == 0 ? 'danger' : 'basic'"
              />
            </div>
            <div class="col-2 col-md-1" style="text-align: right">
              <nb-icon
                class="addIcon"
                status="basic"
                [icon]="tempInvoice.laep[i].isVisible ? 'eye-outline' : 'eye-off-outline'"
                pack="eva"
                (click)="tempInvoice.laep[i].isVisible = !tempInvoice.laep[i].isVisible; isFormDirty.next(true)"
                [options]="{ animation: { type: 'pulse' } }"
              ></nb-icon>
              <nb-icon
                class="xIcon"
                status="basic"
                icon="trash-2-outline"
                pack="eva"
                (click)="tempInvoice.laep.splice(i, 1); isFormDirty.next(true)"
                [options]="{ animation: { type: 'shake' } }"
              ></nb-icon>
            </div>
          </div>
        </nb-list-item>
      </nb-list>
      <div *ngIf="config.hasPreliminary" class="form-control-group">
        <label class="label" for="input-dep">Detalhes: (Pontuação final necessária)</label>
        <textarea
          nbInput
          [(ngModel)]="tempInvoice.dep"
          #dep="ngModel"
          id="input-dep"
          name="dep"
          placeholder="Digite o texto do período de execução"
          fullWidth
          fieldSize="large"
          [minlength]="validation.dep.minLength"
          [maxlength]="validation.dep.maxLength"
          [status]="dep.dirty ? (dep.invalid ? 'danger' : 'success') : 'basic'"
          [attr.aria-invalid]="dep.invalid && dep.touched ? true : null"
          [disabled]="false"
        ></textarea>
        <ng-container *ngIf="dep.invalid && dep.touched">
          <p class="caption status-danger" *ngIf="dep.errors?.minlength || dep.errors?.maxlength">
            O período de execução deve conter entre
            {{ validation.dep.minLength }} a
            {{ validation.dep.maxLength }}
            caracteres
          </p>
        </ng-container>
      </div>
      <div *ngIf="config.hasExecutive" class="row" style="margin-top: 8px">
        <div class="col-auto">
          <label class="label-divider">Etapa Executiva</label>
        </div>
        <div class="col">
          <hr />
        </div>
      </div>
      <div *ngIf="config.hasExecutive" class="row">
        <div class="form-control-group col-md-9">
          <label class="label" for="input-peee">Período de execução: (Já está entre parênteses)</label>
          <textarea
            nbInput
            [(ngModel)]="tempInvoice.peee"
            #peee="ngModel"
            id="input-peee"
            name="peee"
            placeholder="Digite o texto do período de execução"
            fullWidth
            fieldSize="large"
            [minlength]="validation.peee.minLength"
            [maxlength]="validation.peee.maxLength"
            [status]="peee.dirty ? (peee.invalid ? 'danger' : 'success') : 'basic'"
            [attr.aria-invalid]="peee.invalid && peee.touched ? true : null"
            [disabled]="false"
          ></textarea>
          <ng-container *ngIf="peee.invalid && peee.touched">
            <p class="caption status-danger" *ngIf="peee.errors?.minlength || peee.errors?.maxlength">
              O período de execução deve conter entre
              {{ validation.peee.minLength }} a
              {{ validation.peee.maxLength }}
              caracteres
            </p>
          </ng-container>
        </div>
        <div class="form-control-group col-md-3">
          <label class="label" for="toggle-executiveStage">Quebra de página</label>
          <br />
          <nb-checkbox
            [(ngModel)]="tempInvoice.hasPageBreak.executiveStage"
            #executiveStagePageBreak="ngModel"
            name="executiveStagePageBreak"
            id="toggle-executiveStage"
            [status]="executiveStagePageBreak.value ? 'success' : 'basic'"
          >
            Adicionar quebra de página no PDF
          </nb-checkbox>
        </div>
      </div>
      <div *ngIf="config.hasExecutive" class="row">
        <div class="col-md-11">
          <div class="form-control-group">
            <label class="label" for="input-aee">Atividades: (Pontuação final automática)</label>
            <input
              nbInput
              [(ngModel)]="options.aee"
              #laee="ngModel"
              id="input-aee"
              name="laee"
              placeholder="Atividade"
              fullWidth
              fieldSize="large"
              [status]="laee.value ? 'success' : 'basic'"
              [attr.aria-invalid]="laee.invalid && laee.touched ? true : null"
            />
          </div>
        </div>
        <div class="col-md-1">
          <button
            nbButton
            type="button"
            fullWidth
            status="primary"
            size="large"
            style="margin-top: 28px"
            [disabled]="!laee.value"
            (click)="tempInvoice.laee.push({ text: options.aee, isVisible: true }); options.aee = ''"
          >
            +
          </button>
        </div>
      </div>
      <nb-list *ngIf="config.hasExecutive" style="width: 100%; padding: 10px 0">
        <nb-list-item *ngFor="let activity of tempInvoice.laee; let i = index; trackBy: trackByIndex">
          <div class="row irow">
            <div class="col-10 col-md-11">
              <input
                nbInput
                [(ngModel)]="tempInvoice.laee[i].text"
                id="input-laeeItem-{{ i }}"
                name="laeeItem-{{ i }}"
                placeholder="atividade"
                fullWidth
                [status]="tempInvoice.laee[i].text.length == 0 ? 'danger' : 'basic'"
              />
            </div>
            <div class="col-2 col-md-1" style="text-align: right">
              <nb-icon
                class="addIcon"
                status="basic"
                [icon]="tempInvoice.laee[i].isVisible ? 'eye-outline' : 'eye-off-outline'"
                pack="eva"
                (click)="tempInvoice.laee[i].isVisible = !tempInvoice.laee[i].isVisible; isFormDirty.next(true)"
                [options]="{ animation: { type: 'pulse' } }"
              ></nb-icon>
              <nb-icon
                class="xIcon"
                status="basic"
                icon="trash-2-outline"
                pack="eva"
                (click)="tempInvoice.laee.splice(i, 1); isFormDirty.next(true)"
                [options]="{ animation: { type: 'shake' } }"
              ></nb-icon>
            </div>
          </div>
        </nb-list-item>
      </nb-list>
      <div *ngIf="config.hasExecutive" class="form-control-group">
        <label class="label" for="input-dee">Detalhes: (Pontuação final necessária)</label>
        <textarea
          nbInput
          [(ngModel)]="tempInvoice.dee"
          #dee="ngModel"
          id="input-dee"
          name="dee"
          placeholder="Digite o texto do período de execução"
          fullWidth
          fieldSize="large"
          [minlength]="validation.dee.minLength"
          [maxlength]="validation.dee.maxLength"
          [status]="dee.dirty ? (dee.invalid ? 'danger' : 'success') : 'basic'"
          [attr.aria-invalid]="dee.invalid && dee.touched ? true : null"
          [disabled]="false"
        ></textarea>
        <ng-container *ngIf="dee.invalid && dee.touched">
          <p class="caption status-danger" *ngIf="dee.errors?.minlength || dee.errors?.maxlength">
            O período de execução deve conter entre
            {{ validation.dee.minLength }} a
            {{ validation.dee.maxLength }}
            caracteres
          </p>
        </ng-container>
      </div>
      <div *ngIf="config.hasComplementary" class="row" style="margin-top: 8px">
        <div class="col-auto">
          <label class="label-divider">Etapa Complementar</label>
        </div>
        <div class="col">
          <hr />
        </div>
      </div>
      <div *ngIf="config.hasComplementary" class="row">
        <div *ngIf="config.hasComplementary" class="form-control-group col-md-9">
          <label class="label" for="input-peec">Período de execução: (Já está entre parênteses)</label>
          <textarea
            nbInput
            [(ngModel)]="tempInvoice.peec"
            #peec="ngModel"
            id="input-peec"
            name="peec"
            placeholder="Digite o texto do período de execução"
            fullWidth
            fieldSize="large"
            [minlength]="validation.peec.minLength"
            [maxlength]="validation.peec.maxLength"
            [status]="peec.dirty ? (peec.invalid ? 'danger' : 'success') : 'basic'"
            [attr.aria-invalid]="peec.invalid && peec.touched ? true : null"
            [disabled]="false"
          ></textarea>
          <ng-container *ngIf="peec.invalid && peec.touched">
            <p class="caption status-danger" *ngIf="peec.errors?.minlength || peec.errors?.maxlength">
              O período de execução deve conter entre
              {{ validation.peec.minLength }} a
              {{ validation.peec.maxLength }}
              caracteres
            </p>
          </ng-container>
        </div>
        <div class="form-control-group col-md-3">
          <label class="label" for="toggle-complementaryStage">Quebra de página</label>
          <br />
          <nb-checkbox
            [(ngModel)]="tempInvoice.hasPageBreak.complementaryStage"
            #complementaryStagePageBreak="ngModel"
            name="complementaryStagePageBreak"
            id="toggle-complementaryStage"
            [status]="complementaryStagePageBreak.value ? 'success' : 'basic'"
          >
            Adicionar quebra de página no PDF
          </nb-checkbox>
        </div>
      </div>
      <div *ngIf="config.hasComplementary" class="row">
        <div class="col-md-11">
          <div class="form-control-group">
            <label class="label" for="input-aec">Atividades: (Pontuação final automática)</label>
            <input
              nbInput
              [(ngModel)]="options.aec"
              #laec="ngModel"
              id="input-aec"
              name="laec"
              placeholder="Atividade"
              fullWidth
              fieldSize="large"
              [status]="laec.value ? 'success' : 'basic'"
              [attr.aria-invalid]="laec.invalid && laec.touched ? true : null"
            />
          </div>
        </div>
        <div class="col-md-1">
          <button
            nbButton
            type="button"
            fullWidth
            status="primary"
            size="large"
            style="margin-top: 28px"
            [disabled]="!laec.value"
            (click)="tempInvoice.laec.push({ text: options.aec, isVisible: true }); options.aec = ''"
          >
            +
          </button>
        </div>
      </div>
      <nb-list *ngIf="config.hasComplementary" style="width: 100%; padding: 10px 0">
        <nb-list-item
          *ngFor="let activity of tempInvoice.laec ? tempInvoice.laec : []; let i = index; trackBy: trackByIndex"
        >
          <div class="row irow">
            <div class="col-10 col-md-11">
              <input
                nbInput
                [(ngModel)]="tempInvoice.laec[i].text"
                id="input-laecItem-{{ i }}"
                name="laecItem-{{ i }}"
                placeholder="atividade"
                fullWidth
                [status]="tempInvoice.laec[i].text.length == 0 ? 'danger' : 'basic'"
              />
            </div>
            <div class="col-2 col-md-1" style="text-align: right">
              <nb-icon
                class="addIcon"
                status="basic"
                [icon]="tempInvoice.laec[i].isVisible ? 'eye-outline' : 'eye-off-outline'"
                pack="eva"
                (click)="tempInvoice.laec[i].isVisible = !tempInvoice.laec[i].isVisible; isFormDirty.next(true)"
                [options]="{ animation: { type: 'pulse' } }"
              ></nb-icon>
              <nb-icon
                class="xIcon"
                status="basic"
                icon="trash-2-outline"
                pack="eva"
                (click)="tempInvoice.laec.splice(i, 1); isFormDirty.next(true)"
                [options]="{ animation: { type: 'shake' } }"
              ></nb-icon>
            </div>
          </div>
        </nb-list-item>
      </nb-list>
      <div *ngIf="config.hasComplementary" class="form-control-group">
        <label class="label" for="input-dec">Detalhes: (Pontuação final necessária)</label>
        <textarea
          nbInput
          [(ngModel)]="tempInvoice.dec"
          #dec="ngModel"
          id="input-dec"
          name="dec"
          placeholder="Digite o texto do período de execução"
          fullWidth
          fieldSize="large"
          [minlength]="validation.dec.minLength"
          [maxlength]="validation.dec.maxLength"
          [status]="dec.dirty ? (dec.invalid ? 'danger' : 'success') : 'basic'"
          [attr.aria-invalid]="dec.invalid && dec.touched ? true : null"
          [disabled]="false"
        ></textarea>
        <ng-container *ngIf="dec.invalid && dec.touched">
          <p class="caption status-danger" *ngIf="dec.errors?.minlength || dec.errors?.maxlength">
            O período de execução deve conter entre
            {{ validation.dec.minLength }} a
            {{ validation.dec.maxLength }}
            caracteres
          </p>
        </ng-container>
      </div>
      <div class="row" style="margin-top: 8px">
        <div class="col-auto">
          <label class="label-divider">Valores</label>
        </div>
        <div class="col">
          <hr />
        </div>
      </div>
      <div class="row">
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="input-product-type" style="display: flex; margin-top: 4px">Tipo da lista</label>
            <nb-radio-group
              [(ngModel)]="tempInvoice.productListType"
              (ngModelChange)="options.valueType = '$'"
              #productListType="ngModel"
              id="input-product-list-type"
              name="productListType"
              style="height: 16px"
            >
              <nb-radio value="1" style="height: 16px">Simplificada</nb-radio>
              <nb-radio value="2" style="height: 16px">Completa</nb-radio>
            </nb-radio-group>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="toggle-valuesTable" style="display: flex; margin-top: 4px">
              Quebra de página:
            </label>
            <nb-checkbox
              [(ngModel)]="tempInvoice.hasPageBreak.valuesTable"
              #valuesTablePageBreak="ngModel"
              name="valuesTablePageBreak"
              id="toggle-valuesTable"
              [status]="valuesTablePageBreak.value ? 'success' : 'basic'"
            >
              Adicionar quebra de página no PDF
            </nb-checkbox>
          </div>
        </div>

        <div
          [ngClass]="{
            'col-12': true,
            'col-md-3': tempInvoice.productListType == '2',
            'col-md-7': tempInvoice.productListType == '1'
          }"
        >
          <div class="form-control-group">
            <label class="label" for="input-product">Produto:</label>
            <input
              nbInput
              [(ngModel)]="options.product.name"
              #product="ngModel"
              id="input-product"
              name="product"
              placeholder="Nome do produto"
              fullWidth
              fieldSize="large"
              [status]="product.value ? 'success' : 'basic'"
              [attr.aria-invalid]="product.invalid && product.touched ? true : null"
            />
          </div>
        </div>
        <div class="col-6 col-md-2" *ngIf="tempInvoice.productListType == '2'">
          <div class="form-control-group">
            <label class="label" for="input-product">Quantidade:</label>
            <input
              nbInput
              [(ngModel)]="options.product.amount"
              (ngModelChange)="updateProductTotal()"
              #productAmount="ngModel"
              id="input-product-amount"
              name="productAmount"
              placeholder="Quantidade"
              fullWidth
              fieldSize="large"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              ngxSelectAllText
              [status]="productAmount.value ? 'success' : 'basic'"
              [attr.aria-invalid]="productAmount.invalid && productAmount.touched ? true : null"
            />
          </div>
        </div>
        <div class="col-6 col-md-2" *ngIf="tempInvoice.productListType == '2'">
          <div class="form-control-group">
            <label class="label" for="input-unit">Unidade:</label>
            <nb-select
              [(ngModel)]="options.product.unit"
              #unit="ngModel"
              id="input-unit"
              name="unit"
              placeholder="Selecione a unidade"
              fullWidth
              size="large"
            >
              [required]="validation.unit.required" [status]=" unit.dirty ? (unit.invalid ? 'danger' : 'success') :
              'basic' " [attr.aria-invalid]="unit.invalid && unit.touched ? true : null"
              <nb-option *ngFor="let unit of config.units" [value]="unit">
                {{ unit }}
              </nb-option>
            </nb-select>
          </div>
        </div>
        <div
          [ngClass]="{
            'col-6': tempInvoice.productListType == '2',
            'col-10': tempInvoice.productListType == '1',
            'col-md-2': tempInvoice.productListType == '2',
            'col-md-4': tempInvoice.productListType == '1'
          }"
        >
          <div class="form-control-group">
            <label class="label" for="input-paid" style="display: flex; margin-top: 4px">
              <span style="margin-right: 10px">Valor:</span>
              <nb-radio-group
                *ngIf="tempInvoice.productListType == '1'"
                [(ngModel)]="options.valueType"
                #valueType="ngModel"
                id="input-value-type"
                name="valueType"
                style="height: 16px"
              >
                <nb-radio value="$" style="height: 16px">R$</nb-radio>
                <nb-radio value="%" style="height: 16px">%</nb-radio>
              </nb-radio-group>
            </label>
            <input
              nbInput
              [(ngModel)]="options.product.value"
              (ngModelChange)="updateProductTotal()"
              #paid="ngModel"
              id="input-paid"
              name="paid"
              placeholder="Valor"
              fullWidth
              fieldSize="large"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              ngxSelectAllText
              [status]="paid.value ? 'success' : 'basic'"
              [attr.aria-invalid]="paid.invalid && paid.touched ? true : null"
            />
          </div>
        </div>
        <div class="col-10 col-md-2" *ngIf="tempInvoice.productListType == '2'">
          <div class="form-control-group">
            <label class="label" for="input-materialTotal">Total:</label>
            <input
              nbInput
              [(ngModel)]="options.product.total"
              #productTotal="ngModel"
              id="input-productTotal"
              name="productTotal"
              placeholder="Total"
              fullWidth
              fieldSize="large"
              disabled="true"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              ngxSelectAllText
              [status]="productTotal.value ? 'success' : 'basic'"
              [attr.aria-invalid]="productTotal.invalid && productTotal.touched ? true : null"
            />
          </div>
        </div>
        <div class="col-2 col-md-1">
          <button
            nbButton
            type="button"
            fullWidth
            status="primary"
            size="large"
            style="margin-top: 28px"
            [disabled]="isAddProductDisabled()"
            (click)="addProduct()"
          >
            +
          </button>
        </div>
      </div>
      <nb-list style="width: 100%; padding: 10px 0">
        <nb-list-item *ngFor="let product of tempInvoice.products; let i = index; trackBy: trackByIndex">
          <div class="row paymentRow">
            <div
              [ngClass]="{
                'col-12': true,
                'col-md-3': tempInvoice.productListType == '2',
                'col-md-7': tempInvoice.productListType == '1'
              }"
            >
              <input
                nbInput
                [(ngModel)]="tempInvoice.products[i].name"
                id="input-product-{{ i }}"
                name="product-{{ i }}"
                placeholder="produto"
                fullWidth
                [status]="tempInvoice.products[i].name.length == 0 ? 'danger' : 'basic'"
                (focusout)="tempInvoice.products[i].name = tempInvoice.products[i].name.toUpperCase()"
              />
              <nb-list class="subproducts-list" *ngIf="product.subproducts.length > 0">
                <nb-list-item *ngFor="let subproduct of product.subproducts; let j = index; trackBy: trackByIndex">
                  <div class="row paymentRow">
                    <div class="col-10 col-md-11">
                      <input
                        nbInput
                        [(ngModel)]="product.subproducts[j]"
                        id="input-subproduct-{{ i }}-{{ j }}"
                        name="subproduct-{{ i }}-{{ j }}"
                        placeholder="produto"
                        fullWidth
                        [status]="product.subproducts[j].length == 0 ? 'danger' : 'basic'"
                        (focusout)="product.subproducts[j] = product.subproducts[j].toUpperCase()"
                      />
                    </div>
                    <div class="col-2 col-md-1" style="text-align: right">
                      <nb-icon
                        class="xIcon"
                        status="basic"
                        icon="trash-2-outline"
                        pack="eva"
                        (click)="product.subproducts.splice(j, 1); isFormDirty.next(true)"
                        [options]="{ animation: { type: 'shake' } }"
                      ></nb-icon>
                    </div>
                  </div>
                </nb-list-item>
              </nb-list>
            </div>
            <div class="col-3 col-md-2" *ngIf="tempInvoice.productListType == '2'">
              <input
                nbInput
                [(ngModel)]="tempInvoice.products[i].amount"
                (ngModelChange)="
                  updateItemTotal(tempInvoice.products, i);
                  updatePercentage(tempInvoice.products, i);
                  updateTotal('product')
                "
                id="input-productAmount-{{ i }}"
                name="productAmount-{{ i }}"
                placeholder="Quantidade"
                fullWidth
                [brmasker]="{
                  money: true,
                  thousand: '.',
                  decimalCaracter: ',',
                  decimal: 2
                }"
                ngxSelectAllText
                [status]="tempInvoice.products[i].amount ? 'success' : 'basic'"
              />
            </div>
            <div class="col-3 col-md-2" *ngIf="tempInvoice.productListType == '2'">
              <nb-select
                [(ngModel)]="tempInvoice.products[i].unit"
                #unit="ngModel"
                id="input-unit-{{ i }}"
                name="unit-{{ i }}"
                placeholder="Selecione a unidade"
                fullWidth
                size="large"
              >
                <nb-option *ngFor="let unit of config.units" [value]="unit">
                  {{ unit }}
                </nb-option>
              </nb-select>
            </div>
            <div
              [ngClass]="{
                'col-3': tempInvoice.productListType == '2',
                'col-5': tempInvoice.productListType == '1',
                'col-md-2': true
              }"
            >
              <input
                nbInput
                [(ngModel)]="tempInvoice.products[i].value"
                (ngModelChange)="
                  tempInvoice.productListType == '2' ? updateItemTotal(tempInvoice.products, i) : '';
                  updatePercentage(tempInvoice.products, i);
                  updateTotal('product')
                "
                id="input-productValue-{{ i }}"
                name="productValue-{{ i }}"
                placeholder="Valor"
                fullWidth
                [brmasker]="{
                  money: true,
                  thousand: '.',
                  decimalCaracter: ',',
                  decimal: 2
                }"
                ngxSelectAllText
                [status]="tempInvoice.products[i].value ? 'success' : 'basic'"
              />
            </div>
            <div
              *ngIf="tempInvoice.productListType == '1'"
              class="col-4 col-md-2"
              style="display: flex; align-items: center"
            >
              <input
                nbInput
                [(ngModel)]="tempInvoice.products[i].locals.percentage"
                (ngModelChange)="updateValue(tempInvoice.products, i); updateTotal('product')"
                id="input-productPercentage-{{ i }}"
                name="productPercentage-{{ i }}"
                placeholder="Porcentagem"
                fullWidth
                [brmasker]="{
                  money: true,
                  thousand: '.',
                  decimalCaracter: ',',
                  decimal: 2
                }"
                ngxSelectAllText
                [status]="tempInvoice.products[i].value ? 'success' : 'basic'"
              />
              %
            </div>
            <div class="col-3 col-md-2" *ngIf="tempInvoice.productListType == '2'">
              {{ product.total }}
            </div>
            <div class="col-3 col-md-1" style="text-align: right">
              <nb-icon
                class="addIcon"
                status="basic"
                icon="plus-outline"
                pack="eva"
                (click)="addSubproduct(product)"
                [options]="{ animation: { type: 'pulse' } }"
              ></nb-icon>
              <nb-icon
                class="xIcon"
                status="basic"
                icon="trash-2-outline"
                pack="eva"
                (click)="tempInvoice.products.splice(i, 1); updateTotal('product')"
                [options]="{ animation: { type: 'shake' } }"
              ></nb-icon>
            </div>
          </div>
        </nb-list-item>
        <nb-list-item>
          <div class="row paymentRow">
            <div class="col-4 col-md-7" style="text-align: right">Subtotal:</div>
            <div class="col-4 col-md-2">
              {{ options.subtotal }}
            </div>
            <div class="col-md-3"></div>
          </div>
        </nb-list-item>
        <nb-list-item>
          <div class="row paymentRow">
            <div
              class="col-12 col-md-7"
              [ngStyle]="{
                'text-align': isPhone() == true ? 'left' : 'right'
              }"
            >
              Desconto:
            </div>
            <div class="col-6 col-md-2">
              <input
                nbInput
                [(ngModel)]="tempInvoice.discount"
                (ngModelChange)="updateDiscountPercentage(); updateTotal('product')"
                #discountValue="ngModel"
                id="input-discountValue"
                name="discountValue"
                placeholder="Desconto"
                fullWidth
                [brmasker]="{
                  money: true,
                  thousand: '.',
                  decimalCaracter: ',',
                  decimal: 2
                }"
                ngxSelectAllText
                [status]="discountValue.dirty ? (discountValue.value ? 'success' : 'basic') : 'basic'"
                [attr.aria-invalid]="discountValue.invalid && discountValue.touched ? true : null"
              />
            </div>
            <div class="col-6 col-md-2" style="display: flex; align-items: center">
              <input
                nbInput
                [(ngModel)]="options.discountPercentage"
                (ngModelChange)="updateDiscountValue(); updateTotal('product')"
                #discountPercentage="ngModel"
                id="input-discountPercentage"
                name="discountPercentage"
                placeholder="Porcentagem"
                fullWidth
                [brmasker]="{
                  money: true,
                  thousand: '.',
                  decimalCaracter: ',',
                  decimal: 2
                }"
                ngxSelectAllText
                [status]="discountPercentage.dirty ? (discountPercentage.value ? 'success' : 'basic') : 'basic'"
                [attr.aria-invalid]="discountPercentage.invalid && discountPercentage.touched ? true : null"
              />
              %
            </div>
            <div class="col-1"></div>
          </div>
        </nb-list-item>
        <nb-list-item>
          <div class="row paymentRow">
            <div class="col-6 col-md-3">
              <nb-icon
                class="addIcon mr-1"
                status="basic"
                icon="refresh-outline"
                nbTooltip="Atualizar valor bruto do contrato"
                [nbTooltipTrigger]="isPhone() ? tooltipTriggers.NOOP : tooltipTriggers.HINT"
                nbTooltipPlacement="top"
                nbTooltipStatus="info"
                pack="eva"
                (click)="updateInvoiceValue()"
                [options]="{ animation: { type: 'pulse' } }"
              ></nb-icon>
              Contrato: {{ tempInvoice.value }}
            </div>
            <div class="col-6 col-md-3">Restante: {{ remainingBalance('product') }}</div>
            <div class="col-4 col-md-1" style="text-align: right">Total:</div>
            <div
              class="col-4 col-md-2"
              [ngClass]="{
                danger: !isTotalOK(),
                success: isTotalOK()
              }"
            >
              {{ options.total }}
            </div>
            <div
              class="col-4 col-md-1"
              [ngClass]="{
                danger: !isTotalOK(),
                success: isTotalOK()
              }"
            >
              {{ getRemainingPercentage() }}
            </div>
            <div class="col-md-2"></div>
          </div>
        </nb-list-item>
      </nb-list>
      <div *ngIf="config.hasStageName" class="row">
        <div class="col-md-7">
          <div class="form-control-group">
            <label class="label" for="input-stage">Parcelamentos:</label>
            <input
              nbInput
              [(ngModel)]="options.stage.name"
              #stage="ngModel"
              id="input-stage"
              name="stage"
              placeholder="Nome do parcelamento"
              fullWidth
              fieldSize="large"
              [status]="stage.value ? 'success' : 'basic'"
              [attr.aria-invalid]="stage.invalid && stage.touched ? true : null"
            />
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-control-group">
            <label class="label" for="input-paid" style="display: flex; margin-top: 4px">
              <span style="margin-right: 10px">Valor:</span>
              <nb-radio-group
                [(ngModel)]="options.stageValueType"
                #stageValueType="ngModel"
                id="input-value-type"
                name="stageValueType"
                style="height: 16px"
              >
                <nb-radio value="$" style="height: 16px">R$</nb-radio>
                <nb-radio value="%" style="height: 16px">%</nb-radio>
              </nb-radio-group>
            </label>
            <input
              nbInput
              [(ngModel)]="options.stage.value"
              #stagePaid="ngModel"
              id="input-stagePaid"
              name="stagePaid"
              placeholder="Valor"
              fullWidth
              fieldSize="large"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              ngxSelectAllText
              [status]="stagePaid.value ? 'success' : 'basic'"
              [attr.aria-invalid]="stagePaid.invalid && stagePaid.touched ? true : null"
            />
          </div>
        </div>
        <div class="col-md-1">
          <button
            nbButton
            type="button"
            fullWidth
            status="primary"
            size="large"
            style="margin-top: 28px"
            [disabled]="!stage.value || !stagePaid.value"
            (click)="addStage()"
          >
            +
          </button>
        </div>
        <div class="form-control-group col-md-4">
          <label for="toggle-stagesTable" class="label" style="display: flex; margin-top: 4px">Quebra de página</label>
          <nb-checkbox
            [(ngModel)]="tempInvoice.hasPageBreak.stagesTable"
            #stagesTablePageBreak="ngModel"
            name="stagesTablePageBreak"
            id="toggle-stagesTable"
            [status]="stagesTablePageBreak.value ? 'success' : 'basic'"
          >
            Adicionar quebra de página no PDF
          </nb-checkbox>
        </div>
      </div>
      <nb-list *ngIf="config.hasStageName" style="width: 100%; padding: 10px 0">
        <nb-list-item *ngFor="let stage of tempInvoice.stages; let i = index; trackBy: trackByIndex">
          <div class="row paymentRow">
            <div class="col-12 col-md-7">
              <input
                nbInput
                [(ngModel)]="tempInvoice.stages[i].name"
                id="input-stage-{{ i }}"
                name="stage-{{ i }}"
                placeholder="parcelamento"
                fullWidth
                [status]="tempInvoice.stages[i].name.length == 0 ? 'danger' : 'basic'"
              />
            </div>
            <div class="col-5 col-md-2">
              <input
                nbInput
                [(ngModel)]="tempInvoice.stages[i].value"
                (ngModelChange)="updatePercentage(tempInvoice.stages, i); updateTotal('stage')"
                id="input-stageValue-{{ i }}"
                name="stageValue-{{ i }}"
                placeholder="Valor"
                fullWidth
                [brmasker]="{
                  money: true,
                  thousand: '.',
                  decimalCaracter: ',',
                  decimal: 2
                }"
                ngxSelectAllText
                [status]="tempInvoice.stages[i].value ? 'success' : 'basic'"
              />
            </div>
            <div class="col-5 col-md-2" style="display: flex; align-items: center">
              <input
                nbInput
                [(ngModel)]="tempInvoice.stages[i].locals.percentage"
                (ngModelChange)="updateValue(tempInvoice.stages, i); updateTotal('stage')"
                id="input-stagePercentage-{{ i }}"
                name="stagePercentage-{{ i }}"
                placeholder="Porcentagem"
                fullWidth
                [brmasker]="{
                  money: true,
                  thousand: '.',
                  decimalCaracter: ',',
                  decimal: 2
                }"
                ngxSelectAllText
                [status]="tempInvoice.stages[i].value ? 'success' : 'basic'"
              />
              %
            </div>
            <div class="col-2 col-md-1" style="text-align: right">
              <nb-icon
                class="xIcon"
                status="basic"
                icon="trash-2-outline"
                pack="eva"
                (click)="tempInvoice.stages.splice(i, 1); updateTotal('stage')"
                [options]="{ animation: { type: 'shake' } }"
              ></nb-icon>
            </div>
          </div>
        </nb-list-item>
        <nb-list-item>
          <div class="row paymentRow">
            <div class="col-12 col-md-4">Restante: {{ remainingBalance('stage') }}</div>
            <div class="col-4 col-md-4" style="text-align: right">Total:</div>
            <div
              class="col-4 col-md-2"
              [ngClass]="{
                danger: options.stageTotal !== tempInvoice.value && options.stageTotal !== '0',
                success: options.stageTotal === tempInvoice.value && options.stageTotal !== '0'
              }"
            >
              {{ options.stageTotal }}
            </div>
            <div
              class="col-4 col-md-1"
              [ngClass]="{
                danger: options.stageTotal !== tempInvoice.value && options.stageTotal !== '0',
                success: options.stageTotal === tempInvoice.value && options.stageTotal !== '0'
              }"
            >
              {{ [options.stageTotal, tempInvoice.value] | transformPipe: stringUtil.toPercentage.bind(stringUtil) }}
            </div>
            <div class="col-md-1"></div>
          </div>
        </nb-list-item>
      </nb-list>
      <div *ngIf="config.hasImportants" class="row">
        <div class="col-md-11">
          <div class="form-control-group">
            <label class="label" for="input-important">Importante: (Pontuação final automática)</label>
            <textarea
              nbInput
              [(ngModel)]="options.important"
              #important="ngModel"
              id="input-important"
              name="limportant"
              placeholder="Atividade"
              fullWidth
              fieldSize="large"
              [status]="important.value ? 'success' : 'basic'"
              [attr.aria-invalid]="important.invalid && important.touched ? true : null"
            ></textarea>
          </div>
        </div>
        <div class="col-md-1">
          <button
            nbButton
            type="button"
            fullWidth
            status="primary"
            size="large"
            style="margin-top: 28px"
            [disabled]="!important.value"
            (click)="tempInvoice.importants.push({ text: options.important, isVisible: true }); options.important = ''"
          >
            +
          </button>
        </div>
        <div class="form-control-group col-md-4">
          <label for="toggle-importants" class="label" style="display: flex; margin-top: 4px">Quebra de página</label>
          <nb-checkbox
            [(ngModel)]="tempInvoice.hasPageBreak.importants"
            #importantsPageBreak="ngModel"
            name="importantsPageBreak"
            id="toggle-importants"
            [status]="importantsPageBreak.value ? 'success' : 'basic'"
          >
            Adicionar quebra de página no PDF
          </nb-checkbox>
        </div>
      </div>
      <nb-list *ngIf="config.hasImportants" style="width: 100%; padding: 10px 0">
        <nb-list-item *ngFor="let activity of tempInvoice.importants; let i = index; trackBy: trackByIndex">
          <div class="row irow">
            <div class="col-10 col-md-11">
              <textarea
                nbInput
                [(ngModel)]="tempInvoice.importants[i].text"
                id="input-important-{{ i }}"
                name="important-{{ i }}"
                placeholder="detalhe importante"
                fullWidth
                [status]="tempInvoice.importants[i].text.length == 0 ? 'danger' : 'basic'"
              ></textarea>
            </div>
            <div class="col-2 col-md-1" style="text-align: right">
              <nb-icon
                class="addIcon"
                status="basic"
                [icon]="tempInvoice.importants[i].isVisible ? 'eye-outline' : 'eye-off-outline'"
                pack="eva"
                (click)="
                  tempInvoice.importants[i].isVisible = !tempInvoice.importants[i].isVisible; isFormDirty.next(true)
                "
                [options]="{ animation: { type: 'pulse' } }"
              ></nb-icon>
              <nb-icon
                class="xIcon"
                status="basic"
                icon="trash-2-outline"
                pack="eva"
                (click)="tempInvoice.importants.splice(i, 1); isFormDirty.next(true)"
                [options]="{ animation: { type: 'shake' } }"
              ></nb-icon>
            </div>
          </div>
        </nb-list-item>
      </nb-list>
      <div *ngIf="config.hasMaterialList" class="row" style="margin-top: 8px">
        <div class="col-auto">
          <label class="label-divider">Lista de Materias</label>
        </div>
        <div class="col">
          <hr />
        </div>
      </div>
      <div *ngIf="config.hasMaterialList" class="row">
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="input-material-type" style="display: flex; margin-top: 4px">Tipo da lista:</label>
            <nb-radio-group
              [(ngModel)]="tempInvoice.materialListType"
              (ngModelChange)="updateMaterialList()"
              #materialListType="ngModel"
              id="input-material-list-type"
              name="materialListType"
              style="height: 16px"
            >
              <nb-radio value="1" style="height: 16px">Simplificada</nb-radio>
              <nb-radio value="2" style="height: 16px">Completa</nb-radio>
            </nb-radio-group>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-control-group">
            <label class="label" for="toggle-materialTable" style="display: flex; margin-top: 4px">
              Quebra de página:
            </label>
            <nb-checkbox
              [(ngModel)]="tempInvoice.hasPageBreak.materialTable"
              #materialTablePageBreak="ngModel"
              name="materialTablePageBreak"
              id="toggle-materialTable"
              [status]="materialTablePageBreak.value ? 'success' : 'basic'"
            >
              Adicionar quebra de página no PDF
            </nb-checkbox>
          </div>
        </div>

        <div
          [ngClass]="{
            'col-12': true,
            'col-md-4': tempInvoice.materialListType == '2',
            'col-md-6': tempInvoice.materialListType != '2'
          }"
        >
          <div class="form-control-group">
            <label class="label" for="input-material">Material:</label>
            <input
              nbInput
              [(ngModel)]="options.material.name"
              #material="ngModel"
              id="input-material"
              name="material"
              placeholder="Nome do material/serviço"
              fullWidth
              fieldSize="large"
              [status]="material.value ? 'success' : 'basic'"
              [attr.aria-invalid]="material.invalid && material.touched ? true : null"
            />
          </div>
        </div>
        <div
          [ngClass]="{
            'col-6': tempInvoice.materialListType == '2',
            'col-md-2': tempInvoice.materialListType == '2',
            'col-10': tempInvoice.materialListType != '2',
            'col-md-5': tempInvoice.materialListType != '2'
          }"
        >
          <div class="form-control-group">
            <label class="label" for="input-materialAmount">Quantidade:</label>
            <input
              nbInput
              *ngIf="tempInvoice.materialListType == '1'; else inputMask"
              [(ngModel)]="options.material.amount"
              (ngModelChange)="updateMaterialTotal()"
              #materialAmount="ngModel"
              id="input-materialAmount"
              name="materialAmount"
              placeholder="Quantidade"
              fullWidth
              fieldSize="large"
              [status]="materialAmount.value ? 'success' : 'basic'"
              [attr.aria-invalid]="materialAmount.invalid && materialAmount.touched ? true : null"
            />
            <ng-template #inputMask>
              <input
                nbInput
                [(ngModel)]="options.material.amount"
                (ngModelChange)="updateMaterialTotal()"
                #materialAmount="ngModel"
                id="input-materialAmount"
                name="materialAmount"
                placeholder="Quantidade"
                fullWidth
                fieldSize="large"
                [brmasker]="{
                  money: true,
                  thousand: '.',
                  decimalCaracter: ',',
                  decimal: 2
                }"
                ngxSelectAllText
                [status]="materialAmount.value ? 'success' : 'basic'"
                [attr.aria-invalid]="materialAmount.invalid && materialAmount.touched ? true : null"
              />
            </ng-template>
          </div>
        </div>
        <div class="col-6 col-md-2" *ngIf="tempInvoice.materialListType == '2'">
          <div class="form-control-group">
            <label class="label" for="input-materialValue">Valor unitário:</label>
            <input
              nbInput
              [(ngModel)]="options.material.value"
              (ngModelChange)="updateMaterialTotal()"
              #materialValue="ngModel"
              id="input-materialValue"
              name="materialValue"
              placeholder="Valor"
              fullWidth
              fieldSize="large"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              ngxSelectAllText
              [status]="materialValue.value ? 'success' : 'basic'"
              [attr.aria-invalid]="materialValue.invalid && materialValue.touched ? true : null"
            />
          </div>
        </div>
        <div class="col-10 col-md-3" *ngIf="tempInvoice.materialListType == '2'">
          <div class="form-control-group">
            <label class="label" for="input-materialTotal">Total:</label>
            <input
              nbInput
              [(ngModel)]="options.material.total"
              #materialTotal="ngModel"
              id="input-materialTotal"
              name="materialTotal"
              placeholder="Total"
              fullWidth
              fieldSize="large"
              disabled="true"
              [brmasker]="{
                money: true,
                thousand: '.',
                decimalCaracter: ',',
                decimal: 2
              }"
              ngxSelectAllText
              [status]="materialTotal.value ? 'success' : 'basic'"
              [attr.aria-invalid]="materialTotal.invalid && materialTotal.touched ? true : null"
            />
          </div>
        </div>
        <div class="col-2 col-md-1">
          <button
            nbButton
            type="button"
            fullWidth
            status="primary"
            size="large"
            style="margin-top: 28px"
            [disabled]="isAddMaterialDisabled()"
            (click)="addMaterial()"
          >
            +
          </button>
        </div>
      </div>
      <nb-list *ngIf="config.hasMaterialList" style="width: 100%; padding: 10px 0">
        <nb-list-item *ngFor="let material of tempInvoice.materials; let i = index; trackBy: trackByIndex">
          <div class="row paymentRow">
            <div
              [ngClass]="{
                'col-12': true,
                'col-md-4': tempInvoice.materialListType == '2',
                'col-md-6': tempInvoice.materialListType != '2'
              }"
            >
              <input
                nbInput
                [(ngModel)]="tempInvoice.materials[i].name"
                id="input-material-{{ i }}"
                name="material-{{ i }}"
                placeholder="produto"
                fullWidth
                [status]="tempInvoice.materials[i].name.length == 0 ? 'danger' : 'basic'"
              />
            </div>
            <div
              [ngClass]="{
                'col-3': tempInvoice.materialListType == '2',
                'col-md-2': tempInvoice.materialListType == '2',
                'col-10': tempInvoice.materialListType != '2',
                'col-md-5': tempInvoice.materialListType != '2'
              }"
            >
              <input
                nbInput
                *ngIf="tempInvoice.materialListType == '1'; else nbInputMaskTest"
                [(ngModel)]="tempInvoice.materials[i].amount"
                id="input-materialAmount-{{ i }}"
                name="materialAmount-{{ i }}"
                placeholder="Quantidade"
                fullWidth
                [status]="tempInvoice.materials[i].amount.length == 0 ? 'danger' : 'basic'"
              />
              <ng-template #nbInputMaskTest>
                <input
                  nbInput
                  [(ngModel)]="tempInvoice.materials[i].amount"
                  (ngModelChange)="updateItemTotal(tempInvoice.materials, i); updateTotal('material')"
                  id="input-materialAmount-{{ i }}"
                  name="materialAmount-{{ i }}"
                  placeholder="Quantidade"
                  fullWidth
                  [brmasker]="{
                    money: true,
                    thousand: '.',
                    decimalCaracter: ',',
                    decimal: 2
                  }"
                  ngxSelectAllText
                  [status]="tempInvoice.materials[i].amount.length == 0 ? 'danger' : 'basic'"
                />
              </ng-template>
            </div>
            <div class="col-3 col-md-2" *ngIf="tempInvoice.materialListType == '2'">
              <input
                nbInput
                [(ngModel)]="tempInvoice.materials[i].value"
                (ngModelChange)="updateItemTotal(tempInvoice.materials, i); updateTotal('material')"
                id="input-materialValue-{{ i }}"
                name="materialValue-{{ i }}"
                placeholder="Valor"
                fullWidth
                [brmasker]="{
                  money: true,
                  thousand: '.',
                  decimalCaracter: ',',
                  decimal: 2
                }"
                ngxSelectAllText
                [status]="tempInvoice.materials[i].value.length == 0 ? 'danger' : 'basic'"
              />
            </div>
            <div class="col-4 col-md-3" *ngIf="tempInvoice.materialListType == '2'">
              {{ material.total }}
            </div>
            <div class="col-2 col-md-1" style="text-align: right">
              <nb-icon
                class="xIcon"
                status="basic"
                icon="trash-2-outline"
                pack="eva"
                (click)="tempInvoice.materials.splice(i, 1); updateTotal('material')"
                [options]="{ animation: { type: 'shake' } }"
              ></nb-icon>
            </div>
          </div>
        </nb-list-item>
        <nb-list-item *ngIf="tempInvoice.materialListType == '2'">
          <div class="row paymentRow">
            <div class="col-12 col-md-6"></div>
            <div class="col-4 col-md-2" style="text-align: right">Total:</div>
            <div class="col-4 col-md-3">
              {{ options.materialTotal }}
            </div>
            <div class="col-md-1"></div>
          </div>
        </nb-list-item>
      </nb-list>
    </nb-tab>
  </nb-tabset>
</form>
<button
  (click)="editing ? confirmationDialog() : registerInvoice()"
  nbButton
  fullWidth
  status="primary"
  size="large"
  [disabled]="!form.valid || isNotEdited()"
>
  {{ editing ? 'Atualizar' : 'Cadastrar' }}
</button>
